import errorHandler from './ErrorHandler.js';class GoogleAnalytics{constructor(measurementId){this.measurementId = measurementId;this.isLoaded = false;this.eventQueue = [];this.init()}async init(){if (typeof window === 'undefined') return;try{await this.loadGoogleAnalytics();this.setupGlobalSiteTag();this.setupCustomDimensions();this.setupEnhancedEcommerce()}catch (error){const errorInfo = errorHandler.handle(error,{component: 'GoogleAnalytics', method: 'init'});errorHandler.showToUser(errorInfo);errorHandler.trackError(errorInfo)}}async loadGoogleAnalytics(){return new Promise((resolve, reject) =>{if (window.gtag){this.isLoaded = true;resolve();return}const script = document.createElement('script');script.async = true;script.src = `https: script.onload = () =>{this.isLoaded = true;resolve()};script.onerror = () =>{const error = errorHandler.handle('ga/script-load-failed',{component: 'GoogleAnalytics', method: 'loadGoogleAnalytics'});errorHandler.showToUser(error);reject(new Error(error.message))};document.head.appendChild(script)})}setupGlobalSiteTag(){window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments)}window.gtag = gtag;gtag('js', new Date());gtag('config', this.measurementId,{page_title: document.title, page_location: window.location.href, anonymize_ip: true, enhanced_measurements:{scrolls: true, outbound_clicks: true, site_search: true, video_engagement: true, file_downloads: true}, custom_map:{custom_dimension_1: 'user_type', custom_dimension_2: 'prompt_category', custom_dimension_3: 'llm_model'}})}setupCustomDimensions(){this.setCustomDimension(1, this.getUserType());this.setCustomDimension(4, this.getDeviceType());this.setCustomDimension(5, navigator.language)}setupEnhancedEcommerce(){gtag('config', this.measurementId,{enhanced_ecommerce: true})}trackEvent(eventName, parameters ={}){if (!this.isLoaded){this.eventQueue.push({eventName, parameters});return}try{gtag('event', eventName,{event_category: parameters.category || 'general', event_label: parameters.label, value: parameters.value, ...parameters})}catch (error){const errorInfo = errorHandler.handle('ga/tracking-failed',{component: 'GoogleAnalytics', method: 'trackEvent', eventName: eventName});errorHandler.trackError(errorInfo)}}trackPageView(pagePath, pageTitle){if (!this.isLoaded) return;try{gtag('config', this.measurementId,{page_path: pagePath, page_title: pageTitle})}catch (error){const errorInfo = errorHandler.handle('ga/tracking-failed',{component: 'GoogleAnalytics', method: 'trackPageView', pagePath: pagePath});errorHandler.trackError(errorInfo)}}trackConversion(conversionName, conversionData ={}){this.trackEvent('conversion',{category: 'conversions', label: conversionName, ...conversionData})}setUserProperties(properties){if (!this.isLoaded) return;try{gtag('set', 'user_properties', properties)}catch (error){const errorInfo = errorHandler.handle('ga/tracking-failed',{component: 'GoogleAnalytics', method: 'setUserProperties'});errorHandler.trackError(errorInfo)}}setCustomDimension(index, value){if (!this.isLoaded) return;try{gtag('config', this.measurementId,{[`custom_dimension_${index}`]: value})}catch (error){const errorInfo = errorHandler.handle('ga/tracking-failed',{component: 'GoogleAnalytics', method: 'setCustomDimension', index: index});errorHandler.trackError(errorInfo)}}getUserType(){const hasVisited = localStorage.getItem('prompthub_visited');if (!hasVisited){localStorage.setItem('prompthub_visited', 'true');return 'new_user'}return 'returning_user'}getDeviceType(){const userAgent = navigator.userAgent;if (/tablet|ipad|playbook|silk/i.test(userAgent)){return 'tablet'}if (/mobile|iphone|ipod|android|blackberry|opera|mini|windows\\sce|palm|smartphone|iemobile/i.test(userAgent)){return 'mobile'}return 'desktop'}trackPromptCreated(promptData){this.trackEvent('prompt_created',{category: 'prompt_management', label: promptData.category, custom_dimension_2: promptData.category, content_length: promptData.content?.length || 0, has_variables: promptData.variables?.length > 0});gtag('event', 'add_to_cart',{currency: 'USD', value: 1, items: [{item_id: promptData.id, item_name: promptData.title, item_category: promptData.category, quantity: 1, price: 1}]})}trackPromptExecuted(executionData){this.trackEvent('prompt_executed',{category: 'prompt_execution', label: executionData.llmModel, custom_dimension_3: executionData.llmModel, execution_mode: executionData.executionMode});gtag('event', 'purchase',{transaction_id: executionData.id, value: 1, currency: 'USD', items: [{item_id: executionData.promptId, item_name: executionData.promptTitle, item_category: executionData.category, quantity: 1, price: 1}]})}trackRatingSubmitted(ratingData){this.trackEvent('rating_submitted',{category: 'engagement', label: `rating_${ratingData.rating}`, value: ratingData.rating, has_feedback: Boolean(ratingData.feedback)});if (ratingData.rating >= 4){this.trackConversion('high_rating',{rating: ratingData.rating})}}trackSearch(query, resultCount){this.trackEvent('search',{category: 'site_search', label: query, search_term: query, result_count: resultCount})}trackFilterUsed(filters){this.trackEvent('filter_used',{category: 'navigation', label: Object.keys(filters).join(','), filter_count: Object.keys(filters).length})}trackOnboardingStep(step){this.trackEvent('onboarding_step',{category: 'onboarding', label: step, step_number: this.getStepNumber(step)})}trackPromptCreationStep(step){this.trackEvent('prompt_creation_step',{category: 'prompt_creation_flow', label: step})}getStepNumber(step){const steps ={welcome: 1, tutorial: 2, first_prompt: 3, first_execution: 4, first_rating: 5, completed: 6};return steps[step] || 0}processEventQueue(){while (this.eventQueue.length > 0){const{eventName, parameters}= this.eventQueue.shift();this.trackEvent(eventName, parameters)}}cleanup(){this.eventQueue = []}}if (typeof module !== 'undefined' && module.exports){module.exports = GoogleAnalytics}