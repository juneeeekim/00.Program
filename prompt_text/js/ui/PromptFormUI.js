class PromptFormUI{constructor(promptManager){if (!promptManager){throw new Error('PromptFormUI: promptManagerëŠ” í•„ìˆ˜ íŒŒë¼ë¯¸í„°ì…ë‹ˆë‹¤.')}this.promptManager = promptManager;this.currentPromptId = null;this.isEditMode = false;this.autoSaveTimer = null;this.changeHistory = [];this.historyIndex = -1;this.maxHistorySize = 50;this.formContainer = null;this.titleInput = null;this.descriptionInput = null;this.categorySelect = null;this.tagsInput = null;this.contentTextarea = null;this.variablesContainer = null;this.initializeUI()}initializeUI(){this.createFormHTML();this.attachEventListeners()}createFormHTML(){const container = document.createElement('div');container.className = 'prompt-form-container';container.setAttribute('role', 'form');container.setAttribute('aria-label', 'í”„ë¡¬í”„íŠ¸ ì‘ì„± í¼');container.innerHTML = ` <div class="prompt-form-header"> <h2 id="prompt-form-title">âœ¨ ìƒˆ í”„ë¡¬í”„íŠ¸ ì‘ì„±</h2> <button type="button" class="btn-close" id="prompt-form-close" aria-label="í¼ ë‹«ê¸°"> âœ• </button> </div> <form id="prompt-form" class="prompt-form" novalidate> <!-- ì œëª© ì…ë ¥ --> <div class="form-group"> <label for="prompt-title" class="form-label required"> ì œëª© <span class="char-count"> <span id="title-count">0</span>/100 </span> </label> <input type="text" id="prompt-title" class="form-input" placeholder="í”„ë¡¬í”„íŠ¸ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš” (1-100ì)" maxlength="100" required aria-required="true" aria-describedby="title-error" /> <div id="title-error" class="error-message" role="alert" aria-live="polite"></div> </div> <!-- ì„¤ëª… ì…ë ¥ --> <div class="form-group"> <label for="prompt-description" class="form-label"> ì„¤ëª… (ì„ íƒì‚¬í•­) <span class="char-count"> <span id="description-count">0</span>/500 </span> </label> <textarea id="prompt-description" class="form-textarea" placeholder="í”„ë¡¬í”„íŠ¸ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ìµœëŒ€ 500ì)" maxlength="500" rows="3" aria-describedby="description-help" ></textarea> <small id="description-help" class="form-help"> ì´ í”„ë¡¬í”„íŠ¸ê°€ ì–´ë–¤ ìš©ë„ë¡œ ì‚¬ìš©ë˜ëŠ”ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”. </small> </div> <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ --> <div class="form-group"> <label for="prompt-category" class="form-label required"> ì¹´í…Œê³ ë¦¬ </label> <select id="prompt-category" class="form-select" required aria-required="true" aria-describedby="category-error" > <option value="">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option> <option value="writing">âœï¸ ê¸€ì“°ê¸°</option> <option value="marketing">ğŸ“¢ ë§ˆì¼€íŒ…</option> <option value="development">ğŸ’» ê°œë°œ</option> <option value="analysis">ğŸ“Š ë¶„ì„</option> <option value="creative">ğŸ¨ ì°½ì‘</option> <option value="business">ğŸ’¼ ë¹„ì¦ˆë‹ˆìŠ¤</option> <option value="education">ğŸ“š êµìœ¡</option> <option value="other">ğŸ”§ ê¸°íƒ€</option> </select> <div id="category-error" class="error-message" role="alert" aria-live="polite"></div> </div> <!-- íƒœê·¸ ì…ë ¥ --> <div class="form-group"> <label for="prompt-tags" class="form-label"> íƒœê·¸ (ì„ íƒì‚¬í•­) </label> <input type="text" id="prompt-tags" class="form-input" placeholder="íƒœê·¸ë¥¼ ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥ (ìµœëŒ€ 10ê°œ, ê° 20ì)" aria-describedby="tags-help" /> <small id="tags-help" class="form-help"> ì˜ˆ: ë¸”ë¡œê·¸, SNS, ë§ˆì¼€íŒ… </small> <div id="tags-display" class="tags-display" role="list" aria-label="ì…ë ¥ëœ íƒœê·¸ ëª©ë¡"></div> </div> <!-- í…œí”Œë¦¿ ë‚´ìš© --> <div class="form-group"> <label for="prompt-content" class="form-label required"> í…œí”Œë¦¿ ë‚´ìš© <span class="char-count"> <span id="content-count">0</span>/10000 </span> </label> <textarea id="prompt-content" class="form-textarea form-textarea-large" placeholder="í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì„ ì…ë ¥í•˜ì„¸ìš”&#10;&#10;ë³€ìˆ˜ ì‚¬ìš© ì˜ˆì‹œ:&#10;{{userName}}ë‹˜, ì•ˆë…•í•˜ì„¸ìš”!&#10;{{topic}}ì— ëŒ€í•œ ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”." maxlength="10000" rows="10" required aria-required="true" aria-describedby="content-error content-help" ></textarea> <small id="content-help" class="form-help">{{ë³€ìˆ˜ëª…}}í˜•ì‹ìœ¼ë¡œ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. </small> <div id="content-error" class="error-message" role="alert" aria-live="polite"></div> </div> <!-- ë³€ìˆ˜ ì •ì˜ --> <div class="form-group"> <label class="form-label"> ë³€ìˆ˜ ì •ì˜ (ì„ íƒì‚¬í•­) </label> <div id="variables-container" class="variables-container"> <!-- ë™ì ìœ¼ë¡œ ë³€ìˆ˜ ì…ë ¥ í•„ë“œ ì¶”ê°€ --> </div> <button type="button" id="add-variable-btn" class="btn btn-secondary btn-small" aria-label="ë³€ìˆ˜ ì¶”ê°€"> â• ë³€ìˆ˜ ì¶”ê°€ </button> </div> <!-- ê³µê°œ ì„¤ì • --> <div class="form-group"> <label class="form-checkbox"> <input type="checkbox" id="prompt-public" aria-describedby="public-help" /> <span>ê³µê°œ í”„ë¡¬í”„íŠ¸ë¡œ ì„¤ì •</span> </label> <small id="public-help" class="form-help"> ë‹¤ë¥¸ ì‚¬ìš©ìë“¤ë„ ì´ í”„ë¡¬í”„íŠ¸ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. </small> </div> <!-- ìë™ ì €ì¥ ìƒíƒœ --> <div class="auto-save-status" role="status" aria-live="polite"> <span id="auto-save-indicator" class="save-indicator"></span> </div> <!-- í¼ ì•¡ì…˜ ë²„íŠ¼ --> <div class="form-actions"> <button type="button" id="prompt-cancel-btn" class="btn btn-secondary" aria-label="ì·¨ì†Œ"> ì·¨ì†Œ </button> <button type="submit" id="prompt-submit-btn" class="btn btn-primary" aria-label="ì €ì¥"> ğŸ’¾ ì €ì¥ </button> </div> </form> `;this.formContainer = container;this.cacheFormElements()}cacheFormElements(){this.titleInput = this.formContainer.querySelector('#prompt-title');this.descriptionInput = this.formContainer.querySelector('#prompt-description');this.categorySelect = this.formContainer.querySelector('#prompt-category');this.tagsInput = this.formContainer.querySelector('#prompt-tags');this.contentTextarea = this.formContainer.querySelector('#prompt-content');this.variablesContainer = this.formContainer.querySelector('#variables-container');this.publicCheckbox = this.formContainer.querySelector('#prompt-public');this.autoSaveIndicator = this.formContainer.querySelector('#auto-save-indicator')}attachEventListeners(){this.handleSubmitBound = (e) => this.handleSubmit(e);this.closeHandler = () => this.close();this.titleInputHandler = () => this.updateCharCount('title');this.descriptionInputHandler = () => this.updateCharCount('description');this.contentInputHandler = () =>{this.updateCharCount('content');this.scheduleAutoSave();this.saveToHistory()};this.tagsInputHandler = () => this.updateTagsDisplay();this.tagsBlurHandler = () => this.updateTagsDisplay();this.addVariableHandler = () => this.addVariableField();this.keyboardShortcutsHandler = (e) => this.handleKeyboardShortcuts(e);const form = this.formContainer.querySelector('#prompt-form');form.addEventListener('submit', this.handleSubmitBound);const closeBtn = this.formContainer.querySelector('#prompt-form-close');closeBtn.addEventListener('click', this.closeHandler);const cancelBtn = this.formContainer.querySelector('#prompt-cancel-btn');cancelBtn.addEventListener('click', this.closeHandler);this.titleInput.addEventListener('input', this.titleInputHandler);this.descriptionInput.addEventListener('input', this.descriptionInputHandler);this.contentTextarea.addEventListener('input', this.contentInputHandler);this.tagsInput.addEventListener('input', this.tagsInputHandler);this.tagsInput.addEventListener('blur', this.tagsBlurHandler);const addVariableBtn = this.formContainer.querySelector('#add-variable-btn');addVariableBtn.addEventListener('click', this.addVariableHandler);this.contentTextarea.addEventListener('keydown', this.keyboardShortcutsHandler)}updateCharCount(field){const input = this[`${field}Input`] || this[`${field}Textarea`];const countElement = this.formContainer.querySelector(`#${field}-count`);if (input && countElement){const length = input.value.length;countElement.textContent = length;const maxLength = parseInt(input.getAttribute('maxlength'));const percentage = (length / maxLength) * 100;if (percentage >= 90){countElement.style.color = '#e74c3c'}else if (percentage >= 70){countElement.style.color = '#f39c12'}else{countElement.style.color = '#27ae60'}}}updateTagsDisplay(){const tagsDisplay = this.formContainer.querySelector('#tags-display');const tagsValue = this.tagsInput.value.trim();if (!tagsValue){tagsDisplay.innerHTML = '';return}const tags = tagsValue .split(',') .map((tag) => tag.trim()) .filter((tag) => tag.length > 0) .slice(0, 10);tagsDisplay.innerHTML = tags .map( (tag, index) => ` <span class="tag-item" role="listitem"> <span class="tag-text">${this.escapeHtml(tag)}</span> <button type="button" class="tag-remove" onclick="promptFormUI.removeTag(${index})" aria-label="${tag}íƒœê·¸ ì œê±°"> âœ• </button> </span> ` ) .join('')}removeTag(index){const tags = this.tagsInput.value .split(',') .map((tag) => tag.trim()) .filter((tag) => tag.length > 0);tags.splice(index, 1);this.tagsInput.value = tags.join(', ');this.updateTagsDisplay()}addVariableField(){const variableIndex = this.variablesContainer.children.length;const variableField = document.createElement('div');variableField.className = 'variable-field';variableField.setAttribute('data-index', variableIndex);variableField.innerHTML = ` <input type="text" class="form-input variable-name" placeholder="ë³€ìˆ˜ëª… (ì˜ˆ: userName)" aria-label="ë³€ìˆ˜ëª…" data-index="${variableIndex}" /> <input type="text" class="form-input variable-description" placeholder="ì„¤ëª… (ì˜ˆ: ì‚¬ìš©ì ì´ë¦„)" aria-label="ë³€ìˆ˜ ì„¤ëª…" data-index="${variableIndex}" /> <button type="button" class="btn-icon btn-remove" onclick="promptFormUI.removeVariableField(${variableIndex})" aria-label="ë³€ìˆ˜ ì œê±°"> ğŸ—‘ï¸ </button> `;this.variablesContainer.appendChild(variableField)}removeVariableField(index){const field = this.variablesContainer.querySelector(`[data-index="${index}"]`);if (field){field.remove()}}scheduleAutoSave(){if (this.autoSaveTimer){clearTimeout(this.autoSaveTimer)}this.autoSaveTimer = setTimeout(() =>{this.autoSave()}, 5000)}async autoSave(){if (!this.isEditMode || !this.currentPromptId){return}try{this.showAutoSaveStatus('ì €ì¥ ì¤‘...');const updates = this.getFormData();await this.promptManager.updatePrompt(this.currentPromptId, updates);this.showAutoSaveStatus('âœ“ ì €ì¥ë¨', 'success')}catch (error){console.error('ìë™ ì €ì¥ ì‹¤íŒ¨:', error);this.showAutoSaveStatus('âœ— ì €ì¥ ì‹¤íŒ¨', 'error')}}showAutoSaveStatus(message, type = 'loading'){this.autoSaveIndicator.textContent = message;this.autoSaveIndicator.className = `save-indicator save-${type}`;if (type === 'success' || type === 'error'){setTimeout(() =>{this.autoSaveIndicator.textContent = '';this.autoSaveIndicator.className = 'save-indicator'}, 3000)}}saveToHistory(){const currentContent = this.contentTextarea.value;if (this.changeHistory.length > 0 && this.changeHistory[this.historyIndex] === currentContent){return}this.changeHistory = this.changeHistory.slice(0, this.historyIndex + 1);this.changeHistory.push(currentContent);this.historyIndex++;if (this.changeHistory.length > this.maxHistorySize){this.changeHistory.shift();this.historyIndex--}}handleKeyboardShortcuts(e){if (e.ctrlKey && e.key === 'z' && !e.shiftKey){e.preventDefault();this.undo()}if ((e.ctrlKey && e.key === 'y') || (e.ctrlKey && e.shiftKey && e.key === 'z')){e.preventDefault();this.redo()}}undo(){if (this.historyIndex > 0){this.historyIndex--;this.contentTextarea.value = this.changeHistory[this.historyIndex];this.updateCharCount('content')}}redo(){if (this.historyIndex < this.changeHistory.length - 1){this.historyIndex++;this.contentTextarea.value = this.changeHistory[this.historyIndex];this.updateCharCount('content')}}getFormData(){const tags = this.tagsInput.value .split(',') .map((tag) => tag.trim()) .filter((tag) => tag.length > 0) .slice(0, 10);const variables = Array.from(this.variablesContainer.children) .map((field) =>{const nameInput = field.querySelector('.variable-name');const descInput = field.querySelector('.variable-description');return{name: nameInput.value.trim(), description: descInput.value.trim()}}) .filter((v) => v.name.length > 0);return{title: this.titleInput.value.trim(), description: this.descriptionInput.value.trim(), category: this.categorySelect.value, tags: tags, content: this.contentTextarea.value.trim(), variables: variables, isPublic: this.publicCheckbox.checked}}validateForm(){let isValid = true;const title = this.titleInput.value.trim();const titleError = this.formContainer.querySelector('#title-error');if (!title){titleError.textContent = 'ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';this.titleInput.setAttribute('aria-invalid', 'true');isValid = false}else if (title.length < 1 || title.length > 100){titleError.textContent = 'ì œëª©ì€ 1-100ì ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.';this.titleInput.setAttribute('aria-invalid', 'true');isValid = false}else{titleError.textContent = '';this.titleInput.setAttribute('aria-invalid', 'false')}const category = this.categorySelect.value;const categoryError = this.formContainer.querySelector('#category-error');if (!category){categoryError.textContent = 'ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.';this.categorySelect.setAttribute('aria-invalid', 'true');isValid = false}else{categoryError.textContent = '';this.categorySelect.setAttribute('aria-invalid', 'false')}const content = this.contentTextarea.value.trim();const contentError = this.formContainer.querySelector('#content-error');if (!content){contentError.textContent = 'í…œí”Œë¦¿ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';this.contentTextarea.setAttribute('aria-invalid', 'true');isValid = false}else if (content.length < 1 || content.length > 10000){contentError.textContent = 'í…œí”Œë¦¿ ë‚´ìš©ì€ 1-10000ì ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.';this.contentTextarea.setAttribute('aria-invalid', 'true');isValid = false}else{contentError.textContent = '';this.contentTextarea.setAttribute('aria-invalid', 'false')}return isValid}async handleSubmit(e){e.preventDefault();if (!this.validateForm()){return}try{const submitBtn = this.formContainer.querySelector('#prompt-submit-btn');submitBtn.disabled = true;submitBtn.textContent = 'ì €ì¥ ì¤‘...';const formData = this.getFormData();if (this.isEditMode && this.currentPromptId){await this.promptManager.updatePrompt(this.currentPromptId, formData);this.showSuccessMessage('í”„ë¡¬í”„íŠ¸ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.')}else{const promptId = await this.promptManager.createPrompt(formData);this.currentPromptId = promptId;this.showSuccessMessage('í”„ë¡¬í”„íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.')}this.close();window.dispatchEvent(new CustomEvent('promptListRefresh'))}catch (error){console.error('í¼ ì œì¶œ ì‹¤íŒ¨:', error);this.showErrorMessage(error.message);const submitBtn = this.formContainer.querySelector('#prompt-submit-btn');submitBtn.disabled = false;submitBtn.textContent = 'ğŸ’¾ ì €ì¥'}}open(){this.isEditMode = false;this.currentPromptId = null;this.resetForm();const title = this.formContainer.querySelector('#prompt-form-title');title.textContent = 'âœ¨ ìƒˆ í”„ë¡¬í”„íŠ¸ ì‘ì„±';document.body.appendChild(this.formContainer);this.formContainer.classList.add('active');setTimeout(() => this.titleInput.focus(), 100)}async openForEdit(promptId){try{this.isEditMode = true;this.currentPromptId = promptId;const promptData = await this.promptManager.getPromptById(promptId);this.loadFormData(promptData);const title = this.formContainer.querySelector('#prompt-form-title');title.textContent = 'âœï¸ í”„ë¡¬í”„íŠ¸ í¸ì§‘';document.body.appendChild(this.formContainer);this.formContainer.classList.add('active');setTimeout(() => this.titleInput.focus(), 100)}catch (error){console.error('í”„ë¡¬í”„íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);this.showErrorMessage('í”„ë¡¬í”„íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')}}loadFormData(data){this.titleInput.value = data.title || '';this.descriptionInput.value = data.description || '';this.categorySelect.value = data.category || '';this.tagsInput.value = (data.tags || []).join(', ');this.contentTextarea.value = data.content || '';this.publicCheckbox.checked = data.isPublic || false;this.updateCharCount('title');this.updateCharCount('description');this.updateCharCount('content');this.updateTagsDisplay();this.variablesContainer.innerHTML = '';if (data.variables && data.variables.length > 0){data.variables.forEach(() => this.addVariableField());const nameInputs = this.variablesContainer.querySelectorAll('.variable-name');const descInputs = this.variablesContainer.querySelectorAll('.variable-description');data.variables.forEach((variable, index) =>{if (nameInputs[index]) nameInputs[index].value = variable.name;if (descInputs[index]) descInputs[index].value = variable.description})}this.changeHistory = [this.contentTextarea.value];this.historyIndex = 0}close(){if (this.autoSaveTimer){clearTimeout(this.autoSaveTimer)}this.formContainer.classList.remove('active');setTimeout(() =>{if (this.formContainer.parentNode){this.formContainer.parentNode.removeChild(this.formContainer)}}, 300)}resetForm(){const form = this.formContainer.querySelector('#prompt-form');form.reset();this.variablesContainer.innerHTML = '';this.updateCharCount('title');this.updateCharCount('description');this.updateCharCount('content');this.updateTagsDisplay();const errorMessages = this.formContainer.querySelectorAll('.error-message');errorMessages.forEach((el) => (el.textContent = ''));this.titleInput.setAttribute('aria-invalid', 'false');this.categorySelect.setAttribute('aria-invalid', 'false');this.contentTextarea.setAttribute('aria-invalid', 'false');this.changeHistory = [''];this.historyIndex = 0}showSuccessMessage(message){this.showToast(message, 'success')}showErrorMessage(message){this.showToast(message, 'error')}showToast(message, type = 'info'){const toast = document.createElement('div');toast.className = `toast toast-${type}`;toast.setAttribute('role', 'alert');toast.setAttribute('aria-live', 'polite');toast.textContent = message;document.body.appendChild(toast);setTimeout(() => toast.classList.add('show'), 100);setTimeout(() =>{toast.classList.remove('show');setTimeout(() => toast.remove(), 300)}, 3000)}escapeHtml(text){const div = document.createElement('div');div.textContent = text;return div.innerHTML}cleanup(){if (this.autoSaveTimer){clearTimeout(this.autoSaveTimer);this.autoSaveTimer = null}if (this.formContainer){const form = this.formContainer.querySelector('#prompt-form');if (form && this.handleSubmitBound){form.removeEventListener('submit', this.handleSubmitBound)}const closeBtn = this.formContainer.querySelector('#prompt-form-close');if (closeBtn && this.closeHandler){closeBtn.removeEventListener('click', this.closeHandler)}const cancelBtn = this.formContainer.querySelector('#prompt-cancel-btn');if (cancelBtn && this.closeHandler){cancelBtn.removeEventListener('click', this.closeHandler)}if (this.titleInput && this.titleInputHandler){this.titleInput.removeEventListener('input', this.titleInputHandler)}if (this.descriptionInput && this.descriptionInputHandler){this.descriptionInput.removeEventListener('input', this.descriptionInputHandler)}if (this.contentTextarea && this.contentInputHandler){this.contentTextarea.removeEventListener('input', this.contentInputHandler)}if (this.tagsInput){if (this.tagsInputHandler){this.tagsInput.removeEventListener('input', this.tagsInputHandler)}if (this.tagsBlurHandler){this.tagsInput.removeEventListener('blur', this.tagsBlurHandler)}}const addVariableBtn = this.formContainer.querySelector('#add-variable-btn');if (addVariableBtn && this.addVariableHandler){addVariableBtn.removeEventListener('click', this.addVariableHandler)}if (this.contentTextarea && this.keyboardShortcutsHandler){this.contentTextarea.removeEventListener('keydown', this.keyboardShortcutsHandler)}}this.changeHistory = [];this.historyIndex = -1;this.currentPromptId = null}}if (typeof module !== 'undefined' && module.exports){module.exports = PromptFormUI}