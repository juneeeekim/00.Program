class StarRatingUI{constructor(options ={}){this.container = options.container;this.maxStars = options.maxStars || 5;this.currentRating = options.initialRating || 0;this.hoverRating = 0;this.readonly = options.readonly || false;this.onChange = options.onChange || null;this.stars = [];if (!this.container){throw new Error('container 요소가 필요합니다.')}this.init()}init(){this.render();this.initEventListeners();this.addStyles()}render(){this.container.innerHTML = '';this.container.className = 'star-rating';if (this.readonly){this.container.classList.add('star-rating-readonly')}this.container.setAttribute('role', 'radiogroup');this.container.setAttribute('aria-label', '별점 평가, 5점 만점');this.container.setAttribute('tabindex', '0');for (let starNumber = 1;starNumber <= this.maxStars;starNumber++){const star = this.createStar(starNumber);this.stars.push(star);this.container.appendChild(star)}this.updateStars(this.currentRating)}createStar(index){const star = document.createElement('span');star.className = 'star';star.setAttribute('data-rating', index);star.setAttribute('role', 'radio');star.setAttribute('aria-checked', index <= this.currentRating ? 'true' : 'false');star.setAttribute('aria-label', `${index}점`);star.textContent = '★';if (this.readonly){star.classList.add('star-readonly')}return star}initEventListeners(){if (this.readonly) return;this.removeEventListeners();this.clickHandler = (e) =>{const star = e.target.closest('.star');if (!star) return;const index = Array.from(this.container.children).indexOf(star);if (index !== -1){this.setRating(index + 1)}};this.mouseenterHandler = (e) =>{const star = e.target.closest('.star');if (!star) return;const index = Array.from(this.container.children).indexOf(star);if (index !== -1){this.hoverRating = index + 1;this.updateStars(this.hoverRating)}};this.touchstartHandler = (e) =>{const star = e.target.closest('.star');if (!star) return;e.preventDefault();const index = Array.from(this.container.children).indexOf(star);if (index !== -1){this.setRating(index + 1)}};this.mouseleaveHandler = () =>{this.hoverRating = 0;this.updateStars(this.currentRating)};this.keydownHandler = (e) =>{this.handleKeyboard(e)};this.focusHandler = () =>{this.container.classList.add('star-rating-focused')};this.blurHandler = () =>{this.container.classList.remove('star-rating-focused')};this.container.addEventListener('click', this.clickHandler);this.container.addEventListener('mouseenter', this.mouseenterHandler, true);this.container.addEventListener('touchstart', this.touchstartHandler);this.container.addEventListener('mouseleave', this.mouseleaveHandler);this.container.addEventListener('keydown', this.keydownHandler);this.container.addEventListener('focus', this.focusHandler, true);this.container.addEventListener('blur', this.blurHandler, true)}removeEventListeners(){if (this.clickHandler){this.container.removeEventListener('click', this.clickHandler)}if (this.mouseenterHandler){this.container.removeEventListener('mouseenter', this.mouseenterHandler, true)}if (this.touchstartHandler){this.container.removeEventListener('touchstart', this.touchstartHandler)}if (this.mouseleaveHandler){this.container.removeEventListener('mouseleave', this.mouseleaveHandler)}if (this.keydownHandler){this.container.removeEventListener('keydown', this.keydownHandler)}if (this.focusHandler){this.container.removeEventListener('focus', this.focusHandler, true)}if (this.blurHandler){this.container.removeEventListener('blur', this.blurHandler, true)}}handleKeyboard(e){if (this.readonly) return;let newRating = this.currentRating;switch (e.key){case 'ArrowRight': case 'ArrowUp': e.preventDefault();newRating = Math.min(this.currentRating + 1, this.maxStars);break;case 'ArrowLeft': case 'ArrowDown': e.preventDefault();newRating = Math.max(this.currentRating - 1, 0);break;case 'Home': e.preventDefault();newRating = 1;break;case 'End': e.preventDefault();newRating = this.maxStars;break;case '1': case '2': case '3': case '4': case '5': e.preventDefault();const num = parseInt(e.key);if (num <= this.maxStars){newRating = num}break;default: return}if (newRating !== this.currentRating){this.setRating(newRating)}}setRating(rating){if (this.readonly) return;const oldRating = this.currentRating;this.currentRating = Math.max(0, Math.min(rating, this.maxStars));this.updateStars(this.currentRating);this.container.setAttribute('aria-valuenow', this.currentRating);if (this.onChange && oldRating !== this.currentRating){this.onChange(this.currentRating)}this.animateRating()}updateStars(rating){this.stars.forEach((star, index) =>{const starRating = index + 1;if (starRating <= rating){star.classList.add('star-filled');star.classList.remove('star-empty');star.setAttribute('aria-checked', 'true')}else{star.classList.remove('star-filled');star.classList.add('star-empty');star.setAttribute('aria-checked', 'false')}})}animateRating(){this.stars.forEach((star, index) =>{if (index < this.currentRating){star.style.animation = 'none';setTimeout(() =>{star.style.animation = `starPulse 0.3s ease-out ${index * 0.05}s`}, 10)}})}getRating(){return this.currentRating}setReadonly(readonly){this.readonly = readonly;if (readonly){this.container.classList.add('star-rating-readonly');this.container.removeAttribute('tabindex');this.stars.forEach((star) =>{star.classList.add('star-readonly')})}else{this.container.classList.remove('star-rating-readonly');this.container.setAttribute('tabindex', '0');this.stars.forEach((star) =>{star.classList.remove('star-readonly')})}}addStyles(){if (document.getElementById('star-rating-styles')){return}const style = document.createElement('style');style.id = 'star-rating-styles';style.textContent = ` .star-rating{display: inline-flex;gap: 4px;cursor: pointer;user-select: none;padding: 4px;border-radius: 8px;transition: all 0.3s ease}.star-rating:focus{outline: none}.star-rating-focused{box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.3)}.star-rating-readonly{cursor: default;pointer-events: none}.star{font-size: 32px;width: 44px;height: 44px;display: flex;align-items: center;justify-content: center;color: #ddd;transition: all 0.2s ease;cursor: pointer;border-radius: 4px}.star:hover:not(.star-readonly){transform: scale(1.2)}.star-filled{color: #FFD700;text-shadow: 0 0 10px rgba(255, 215, 0, 0.5)}.star-empty{color: #ddd}.star-readonly{cursor: default}.star-readonly:hover{transform: none}@keyframes starPulse{0%{transform: scale(1)}50%{transform: scale(1.3)}100%{transform: scale(1)}}@media (max-width: 768px){.star{font-size: 28px;width: 44px;height: 44px}}@media (prefers-color-scheme: dark){.star-empty{color: #555}.star-filled{color: #FFD700;text-shadow: 0 0 10px rgba(255, 215, 0, 0.7)}}@media (prefers-contrast: high){.star-filled{color: #FFFF00;text-shadow: none;font-weight: 900}.star-empty{color: #000;font-weight: 900}}@media (prefers-reduced-motion: reduce){.star{transition: none}.star:hover{transform: none}@keyframes starPulse{0%, 100%{transform: scale(1)}}}`;document.head.appendChild(style)}cleanup(){this.container.innerHTML = '';this.stars = []}}if (typeof module !== 'undefined' && module.exports){module.exports = StarRatingUI}