import performanceOptimizer from '../utils/PerformanceOptimizer.js';class PromptListUI{constructor(promptManager, promptFormUI){if (!promptManager || !promptFormUI){throw new Error('PromptListUI: promptManagerì™€ promptFormUIëŠ” í•„ìˆ˜ íŒŒë¼ë¯¸í„°ì…ë‹ˆë‹¤.')}this.promptManager = promptManager;this.promptFormUI = promptFormUI;this.prompts = [];this.filteredPrompts = [];this.currentFilter ={category: 'all', tags: [], searchQuery: ''};this.listContainer = null;this.searchInput = null;this.categoryFilter = null;this.tagsFilter = null;this.performanceOptimizer = performanceOptimizer;this.renderCache = new Map();this.debouncedSearch = this.performanceOptimizer.debounce( (query) => this.handleSearch(query), 300, 'promptListSearch' );this.initializeUI()}initializeUI(){this.createListHTML();this.attachEventListeners();this.loadPrompts()}createListHTML(){const container = document.createElement('div');container.className = 'prompt-list-container';container.setAttribute('role', 'region');container.setAttribute('aria-label', 'í”„ë¡¬í”„íŠ¸ ëª©ë¡');container.innerHTML = ` <div class="prompt-list-header"> <h2>ğŸ“š ì €ì¥ëœ í”„ë¡¬í”„íŠ¸</h2> <button type="button" id="create-prompt-btn" class="btn btn-primary" aria-label="ìƒˆ í”„ë¡¬í”„íŠ¸ ì‘ì„±"> âœ¨ ìƒˆ í”„ë¡¬í”„íŠ¸ </button> </div> <div class="prompt-list-filters"> <!-- ê²€ìƒ‰ --> <div class="filter-group"> <label for="prompt-search" class="sr-only">í”„ë¡¬í”„íŠ¸ ê²€ìƒ‰</label> <input type="search" id="prompt-search" class="filter-input" placeholder="ğŸ” ì œëª©, ì„¤ëª…, íƒœê·¸ë¡œ ê²€ìƒ‰..." aria-label="í”„ë¡¬í”„íŠ¸ ê²€ìƒ‰" /> </div> <!-- ì¹´í…Œê³ ë¦¬ í•„í„° --> <div class="filter-group"> <label for="prompt-category-filter" class="filter-label">ì¹´í…Œê³ ë¦¬</label> <select id="prompt-category-filter" class="filter-select" aria-label="ì¹´í…Œê³ ë¦¬ í•„í„°"> <option value="all">ì „ì²´</option> <option value="writing">âœï¸ ê¸€ì“°ê¸°</option> <option value="marketing">ğŸ“¢ ë§ˆì¼€íŒ…</option> <option value="development">ğŸ’» ê°œë°œ</option> <option value="analysis">ğŸ“Š ë¶„ì„</option> <option value="creative">ğŸ¨ ì°½ì‘</option> <option value="business">ğŸ’¼ ë¹„ì¦ˆë‹ˆìŠ¤</option> <option value="education">ğŸ“š êµìœ¡</option> <option value="other">ğŸ”§ ê¸°íƒ€</option> </select> </div> <!-- ì •ë ¬ --> <div class="filter-group"> <label for="prompt-sort" class="filter-label">ì •ë ¬</label> <select id="prompt-sort" class="filter-select" aria-label="ì •ë ¬ ë°©ì‹"> <option value="recent">ìµœì‹ ìˆœ</option> <option value="oldest">ì˜¤ë˜ëœìˆœ</option> <option value="title">ì œëª©ìˆœ</option> <option value="category">ì¹´í…Œê³ ë¦¬ìˆœ</option> </select> </div> </div> <div class="prompt-list-stats" role="status" aria-live="polite"> <span id="prompt-count">0ê°œì˜ í”„ë¡¬í”„íŠ¸</span> </div> <div id="prompt-list" class="prompt-list" role="list" aria-label="í”„ë¡¬í”„íŠ¸ ëª©ë¡"> <!-- ë™ì ìœ¼ë¡œ í”„ë¡¬í”„íŠ¸ ì¹´ë“œ ì¶”ê°€ --> </div> <div id="prompt-list-empty" class="prompt-list-empty" style="display: none;"> <div class="empty-icon">ğŸ“</div> <h3>ì•„ì§ í”„ë¡¬í”„íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</h3> <p>ìƒˆ í”„ë¡¬í”„íŠ¸ë¥¼ ì‘ì„±í•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”!</p> <button type="button" class="btn btn-primary" onclick="promptFormUI.open()" aria-label="ì²« í”„ë¡¬í”„íŠ¸ ì‘ì„±í•˜ê¸°"> âœ¨ ì²« í”„ë¡¬í”„íŠ¸ ì‘ì„±í•˜ê¸° </button> </div> `;this.listContainer = container;this.cacheListElements()}cacheListElements(){this.searchInput = this.listContainer.querySelector('#prompt-search');this.categoryFilter = this.listContainer.querySelector('#prompt-category-filter');this.sortSelect = this.listContainer.querySelector('#prompt-sort');this.promptList = this.listContainer.querySelector('#prompt-list');this.promptCount = this.listContainer.querySelector('#prompt-count');this.emptyState = this.listContainer.querySelector('#prompt-list-empty')}attachEventListeners(){const createBtn = this.listContainer.querySelector('#create-prompt-btn');createBtn.addEventListener('click', () => this.promptFormUI.open());this.searchInput.addEventListener('input', (e) =>{const query = e.target.value.trim();this.debouncedSearch(query)});this.categoryFilter.addEventListener('change', () => this.handleCategoryFilter());this.sortSelect.addEventListener('change', () => this.handleSort());window.addEventListener('promptListRefresh', () => this.loadPrompts())}async loadPrompts(){try{this.showLoading();const options ={limit: 100, includeDeleted: false};this.prompts = await this.promptManager.getPrompts(options);this.applyFilters();this.renderPrompts()}catch (error){console.error('í”„ë¡¬í”„íŠ¸ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);this.showError('í”„ë¡¬í”„íŠ¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')}}handleSearch(query){this.currentFilter.searchQuery = query.toLowerCase();this.applyFilters();this.renderPrompts()}handleCategoryFilter(){this.currentFilter.category = this.categoryFilter.value;this.applyFilters();this.renderPrompts()}handleSort(){this.renderPrompts()}applyFilters(){this.filteredPrompts = this.prompts.filter((prompt) =>{if (this.currentFilter.category !== 'all' && prompt.category !== this.currentFilter.category){return false}if (this.currentFilter.searchQuery){const query = this.currentFilter.searchQuery;const title = prompt.title.toLowerCase();const description = (prompt.description || '').toLowerCase();const tags = (prompt.tags || []).join(' ').toLowerCase();if (!title.includes(query) && !description.includes(query) && !tags.includes(query)){return false}}return true})}renderPrompts(){if (this.filteredPrompts.length === 0){this.promptList.style.display = 'none';this.emptyState.style.display = 'flex';this.promptCount.textContent = '0ê°œì˜ í”„ë¡¬í”„íŠ¸';return}this.promptList.style.display = 'grid';this.emptyState.style.display = 'none';const sortedPrompts = this.sortPrompts(this.filteredPrompts);const fragment = document.createDocumentFragment();const tempDiv = document.createElement('div');tempDiv.innerHTML = sortedPrompts.map((prompt) => this.memoizedCreatePromptCard(prompt)).join('');while (tempDiv.firstChild){fragment.appendChild(tempDiv.firstChild)}this.promptList.innerHTML = '';this.promptList.appendChild(fragment);this.promptCount.textContent = `${this.filteredPrompts.length}ê°œì˜ í”„ë¡¬í”„íŠ¸`}sortPrompts(prompts){const sortType = this.sortSelect.value;const sorted = [...prompts];switch (sortType){case 'recent': sorted.sort((a, b) => b.createdAt - a.createdAt);break;case 'oldest': sorted.sort((a, b) => a.createdAt - b.createdAt);break;case 'title': sorted.sort((a, b) => a.title.localeCompare(b.title));break;case 'category': sorted.sort((a, b) => a.category.localeCompare(b.category));break}return sorted}createPromptCard(prompt){const categoryIcons ={writing: 'âœï¸', marketing: 'ğŸ“¢', development: 'ğŸ’»', analysis: 'ğŸ“Š', creative: 'ğŸ¨', business: 'ğŸ’¼', education: 'ğŸ“š', other: 'ğŸ”§'};const categoryIcon = categoryIcons[prompt.category] || 'ğŸ“';const tags = (prompt.tags || []).slice(0, 3);const createdDate = this.formatDate(prompt.createdAt);return ` <div class="prompt-card" role="listitem" data-prompt-id="${prompt.id}"> <div class="prompt-card-header"> <div class="prompt-category"> <span class="category-icon">${categoryIcon}</span> <span class="category-name">${this.getCategoryName(prompt.category)}</span> </div> ${prompt.isPublic ? '<span class="public-badge">ğŸŒ ê³µê°œ</span>' : ''}</div> <h3 class="prompt-title">${this.escapeHtml(prompt.title)}</h3> ${prompt.description ? ` <p class="prompt-description">${this.escapeHtml(prompt.description)}</p> ` : ''}${tags.length > 0 ? ` <div class="prompt-tags"> ${tags .map( (tag) => ` <span class="prompt-tag">#${this.escapeHtml(tag)}</span> ` ) .join('')}</div> ` : ''}<div class="prompt-card-footer"> <span class="prompt-date">${createdDate}</span> <span class="prompt-version">v${prompt.currentVersion || '1.0.0'}</span> </div> <div class="prompt-card-actions"> <button type="button" class="btn-action btn-edit" onclick="promptListUI.editPrompt('${prompt.id}')" aria-label="${prompt.title}í¸ì§‘"> âœï¸ í¸ì§‘ </button> <button type="button" class="btn-action btn-use" onclick="promptListUI.usePrompt('${prompt.id}')" aria-label="${prompt.title}ì‚¬ìš©"> â–¶ï¸ ì‚¬ìš© </button> <button type="button" class="btn-action btn-delete" onclick="promptListUI.deletePrompt('${prompt.id}')" aria-label="${prompt.title}ì‚­ì œ"> ğŸ—‘ï¸ </button> </div> </div> `}async editPrompt(promptId){await this.promptFormUI.openForEdit(promptId)}async usePrompt(promptId){try{const prompt = await this.promptManager.getPromptById(promptId);window.dispatchEvent( new CustomEvent('promptUse',{detail:{prompt}}) );this.showSuccess(`"${prompt.title}" í”„ë¡¬í”„íŠ¸ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`)}catch (error){console.error('í”„ë¡¬í”„íŠ¸ ì‚¬ìš© ì‹¤íŒ¨:', error);this.showError('í”„ë¡¬í”„íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')}}async deletePrompt(promptId){const prompt = this.prompts.find((p) => p.id === promptId);if (!prompt) return;const confirmed = confirm(`"${prompt.title}" í”„ë¡¬í”„íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);if (!confirmed) return;try{await this.promptManager.deletePrompt(promptId);this.showSuccess('í”„ë¡¬í”„íŠ¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');this.loadPrompts()}catch (error){console.error('í”„ë¡¬í”„íŠ¸ ì‚­ì œ ì‹¤íŒ¨:', error);this.showError('í”„ë¡¬í”„íŠ¸ë¥¼ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')}}getCategoryName(category){const names ={writing: 'ê¸€ì“°ê¸°', marketing: 'ë§ˆì¼€íŒ…', development: 'ê°œë°œ', analysis: 'ë¶„ì„', creative: 'ì°½ì‘', business: 'ë¹„ì¦ˆë‹ˆìŠ¤', education: 'êµìœ¡', other: 'ê¸°íƒ€'};return names[category] || category}formatDate(date){if (!date) return '';const dateValue = date.toDate ? date.toDate() : new Date(date);const now = new Date();const diff = now - dateValue;if (diff < 60000){return 'ë°©ê¸ˆ ì „'}if (diff < 3600000){const minutes = Math.floor(diff / 60000);return `${minutes}ë¶„ ì „`}if (diff < 86400000){const hours = Math.floor(diff / 3600000);return `${hours}ì‹œê°„ ì „`}if (diff < 604800000){const days = Math.floor(diff / 86400000);return `${days}ì¼ ì „`}return d.toLocaleDateString('ko-KR',{year: 'numeric', month: 'long', day: 'numeric'})}showLoading(){this.promptList.innerHTML = ` <div class="loading-spinner" role="status" aria-live="polite" aria-atomic="true"> <div class="spinner" aria-hidden="true"></div> <p>í”„ë¡¬í”„íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p> </div> `}showSuccess(message){this.showToast(message, 'success')}showError(message){this.showToast(message, 'error')}showToast(message, type = 'info'){const toast = document.createElement('div');toast.className = `toast toast-${type}`;toast.setAttribute('role', 'alert');toast.setAttribute('aria-live', 'polite');toast.textContent = message;document.body.appendChild(toast);setTimeout(() => toast.classList.add('show'), 100);setTimeout(() =>{toast.classList.remove('show');setTimeout(() => toast.remove(), 300)}, 3000)}escapeHtml(text){const div = document.createElement('div');div.textContent = text;return div.innerHTML}mount(parent){parent.appendChild(this.listContainer)}}if (typeof module !== 'undefined' && module.exports){module.exports = PromptListUI}