import FirebaseMonitoring from '../utils/FirebaseMonitoring.js';import GoogleAnalytics from '../utils/GoogleAnalytics.js';import errorHandler from '../utils/ErrorHandler.js';class MonitoringDashboardUI{constructor(){this.firebaseMonitoring = null;this.googleAnalytics = null;this.refreshInterval = null;this.init()}async init(){try{this.firebaseMonitoring = new FirebaseMonitoring();const GA_MEASUREMENT_ID = 'G-XXXXXXXXXX';this.googleAnalytics = new GoogleAnalytics(GA_MEASUREMENT_ID)}catch (error){const errorInfo = errorHandler.handle(error,{component: 'MonitoringDashboardUI', method: 'init'});errorHandler.showToUser(errorInfo);errorHandler.trackError(errorInfo)}}async render(containerId){const container = document.getElementById(containerId);if (!container){const errorInfo = errorHandler.handle('validation/required-field',{component: 'MonitoringDashboardUI', method: 'render', containerId: containerId});errorHandler.showToUser(errorInfo);return}const dashboardData = await this.firebaseMonitoring.getDashboardData();container.innerHTML = ` <div class="monitoring-dashboard"> <div class="dashboard-header"> <h2>ğŸ“Š ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</h2> <div class="dashboard-actions"> <button id="refresh-dashboard" class="btn-refresh"> ğŸ”„ ìƒˆë¡œê³ ì¹¨ </button> <button id="export-metrics" class="btn-export"> ğŸ“¥ ë©”íŠ¸ë¦­ ë‚´ë³´ë‚´ê¸° </button> </div> </div> <div class="dashboard-grid"> <!-- Authentication ì„¹ì…˜ --> <div class="dashboard-card"> <h3>ğŸ‘¤ Authentication</h3> ${this.renderAuthSection(dashboardData.auth)}</div> <!-- Firestore ì„¹ì…˜ --> <div class="dashboard-card"> <h3>ğŸ—„ï¸ Firestore ì‚¬ìš©ëŸ‰</h3> ${this.renderFirestoreSection(dashboardData.firestore)}</div> <!-- ì„±ëŠ¥ ì„¹ì…˜ --> <div class="dashboard-card"> <h3>âš¡ ì„±ëŠ¥ ë©”íŠ¸ë¦­</h3> ${this.renderPerformanceSection(dashboardData.performance)}</div> <!-- ì—ëŸ¬ ë¡œê·¸ ì„¹ì…˜ --> <div class="dashboard-card full-width"> <h3>ğŸ› ìµœê·¼ ì—ëŸ¬ ë¡œê·¸</h3> ${this.renderErrorsSection(dashboardData.errors)}</div> <!-- ì‚¬ìš©ì í™œë™ ì„¹ì…˜ --> <div class="dashboard-card full-width"> <h3>ğŸ“ˆ ì‚¬ìš©ì í™œë™ (ìµœê·¼ 24ì‹œê°„)</h3> ${this.renderActivitySection(dashboardData.activity)}</div> </div> </div> `;this.attachEventListeners();this.startAutoRefresh()}renderAuthSection(authData){if (!authData || !authData.userId){return '<p class="no-data">ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì—†ìŒ</p>'}return ` <div class="metric-list"> <div class="metric-item"> <span class="metric-label">ì‚¬ìš©ì ID:</span> <span class="metric-value">${authData.userId}</span> </div> <div class="metric-item"> <span class="metric-label">ì´ë©”ì¼:</span> <span class="metric-value">${authData.email || 'N/A'}</span> </div> <div class="metric-item"> <span class="metric-label">ì´ë©”ì¼ ì¸ì¦:</span> <span class="metric-value ${authData.emailVerified ? 'verified' : 'unverified'}"> ${authData.emailVerified ? 'âœ… ì¸ì¦ë¨' : 'âŒ ë¯¸ì¸ì¦'}</span> </div> <div class="metric-item"> <span class="metric-label">ê°€ì…ì¼:</span> <span class="metric-value">${new Date(authData.createdAt).toLocaleString('ko-KR')}</span> </div> <div class="metric-item"> <span class="metric-label">ë§ˆì§€ë§‰ ë¡œê·¸ì¸:</span> <span class="metric-value">${new Date(authData.lastSignIn).toLocaleString('ko-KR')}</span> </div> <div class="metric-item"> <span class="metric-label">ì¸ì¦ ì œê³µì:</span> <span class="metric-value">${authData.provider || 'N/A'}</span> </div> </div> `}renderFirestoreSection(firestoreData){if (!firestoreData){return '<p class="no-data">ë°ì´í„° ì—†ìŒ</p>'}return ` <div class="metric-list"> <div class="metric-item"> <span class="metric-label">í”„ë¡¬í”„íŠ¸:</span> <span class="metric-value highlight">${firestoreData.prompts?.count || 0}ê°œ</span> </div> <div class="metric-item"> <span class="metric-label">ì‹¤í–‰ ê¸°ë¡:</span> <span class="metric-value highlight">${firestoreData.executions?.count || 0}ê°œ</span> </div> <div class="metric-item"> <span class="metric-label">í‰ê°€:</span> <span class="metric-value highlight">${firestoreData.ratings?.count || 0}ê°œ</span> </div> <div class="metric-item"> <span class="metric-label">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:</span> <span class="metric-value"> ${new Date(firestoreData.prompts?.lastUpdated).toLocaleString('ko-KR')}</span> </div> </div> `}renderPerformanceSection(performanceData){if (!performanceData){return '<p class="no-data">ë°ì´í„° ì—†ìŒ</p>'}const getPerformanceClass = (time) =>{if (time < 1000) return 'good';if (time < 3000) return 'moderate';return 'poor'};return ` <div class="metric-list"> <div class="metric-item"> <span class="metric-label">í˜ì´ì§€ ë¡œë“œ:</span> <span class="metric-value ${getPerformanceClass(performanceData.pageLoad)}"> ${performanceData.pageLoad}ms </span> </div> <div class="metric-item"> <span class="metric-label">DOM ì¤€ë¹„:</span> <span class="metric-value ${getPerformanceClass(performanceData.domReady)}"> ${performanceData.domReady}ms </span> </div> <div class="metric-item"> <span class="metric-label">ë Œë”ë§:</span> <span class="metric-value ${getPerformanceClass(performanceData.render)}"> ${performanceData.render}ms </span> </div> <div class="metric-item"> <span class="metric-label">ì¸¡ì • ì‹œê°„:</span> <span class="metric-value">${new Date(performanceData.timestamp).toLocaleString('ko-KR')}</span> </div> </div> `}renderErrorsSection(errors){if (!errors || errors.length === 0){return '<p class="no-data">ì—ëŸ¬ ì—†ìŒ âœ…</p>'}return ` <div class="error-list"> ${errors .map( (error) => ` <div class="error-item"> <div class="error-header"> <span class="error-type">${error.type || 'Error'}</span> <span class="error-time">${new Date(error.timestamp).toLocaleString('ko-KR')}</span> </div> <div class="error-message">${error.message}</div> ${error.stack ? `<div class="error-stack">${error.stack}</div>` : ''}</div> ` ) .join('')}</div> `}renderActivitySection(activityData){if (!activityData){return '<p class="no-data">ë°ì´í„° ì—†ìŒ</p>'}return ` <div class="activity-stats"> <div class="stat-card"> <div class="stat-icon">â–¶ï¸</div> <div class="stat-content"> <div class="stat-value">${activityData.last24Hours?.executions || 0}</div> <div class="stat-label">í”„ë¡¬í”„íŠ¸ ì‹¤í–‰</div> </div> </div> <div class="stat-card"> <div class="stat-icon">â­</div> <div class="stat-content"> <div class="stat-value">${activityData.last24Hours?.ratings || 0}</div> <div class="stat-label">í‰ê°€ ì œì¶œ</div> </div> </div> </div> `}attachEventListeners(){const refreshBtn = document.getElementById('refresh-dashboard');if (refreshBtn){refreshBtn.addEventListener('click', () =>{this.refresh()})}const exportBtn = document.getElementById('export-metrics');if (exportBtn){exportBtn.addEventListener('click', () =>{this.firebaseMonitoring.exportMetrics()})}}async refresh(){const container = document.querySelector('.monitoring-dashboard');if (!container) return;container.classList.add('refreshing');try{await this.render(container.parentElement.id)}catch (error){const errorInfo = errorHandler.handle(error,{component: 'MonitoringDashboardUI', method: 'refresh'});errorHandler.showToUser(errorInfo);errorHandler.trackError(errorInfo)}finally{container.classList.remove('refreshing')}}startAutoRefresh(){this.refreshInterval = setInterval( () =>{this.refresh()}, 5 * 60 * 1000 );')}stopAutoRefresh(){if (this.refreshInterval){clearInterval(this.refreshInterval);this.refreshInterval = null}}cleanup(){this.stopAutoRefresh();if (this.firebaseMonitoring){this.firebaseMonitoring.cleanup()}if (this.googleAnalytics){this.googleAnalytics.cleanup()}}}export default MonitoringDashboardUI;