import FirebaseMonitoring from '../utils/FirebaseMonitoring.js';import GoogleAnalytics from '../utils/GoogleAnalytics.js';class MonitoringManager{constructor(analytics = null, gaId = null){this.analytics = analytics;this.ga = window.gtag || null;this.isEnabled = true;this.eventQueue = [];this.firebaseMonitoring = null;this.googleAnalytics = null;this.gaId = gaId;this.init()}async init(){this.firebaseMonitoring = new FirebaseMonitoring();if (this.gaId){this.googleAnalytics = new GoogleAnalytics(this.gaId)}this.initPerformanceMonitoring();this.initErrorTracking();this.setupAlerts();')}initPerformanceMonitoring(){if (typeof window === 'undefined') return;window.addEventListener('load', () =>{setTimeout(() =>{const perfData = performance.getEntriesByType('navigation')[0];if (perfData){this.trackPerformance('page_load',{load_time: Math.round(perfData.loadEventEnd - perfData.fetchStart), dom_content_loaded: Math.round(perfData.domContentLoadedEventEnd - perfData.fetchStart), first_paint: this.getFirstPaint()})}}, 0)})}initErrorTracking(){if (typeof window === 'undefined') return;window.addEventListener('error', (event) =>{this.trackError({message: event.message, source: event.filename, line: event.lineno, column: event.colno, stack: event.error?.stack})});window.addEventListener('unhandledrejection', (event) =>{this.trackError({message: 'Unhandled Promise Rejection', reason: event.reason, stack: event.reason?.stack})})}trackEvent(eventName, eventParams ={}){if (!this.isEnabled) return;try{if (this.analytics && typeof this.analytics.logEvent === 'function'){this.analytics.logEvent(eventName, eventParams)}if (this.ga){this.ga('event', eventName, eventParams)}}catch (error){console.error('âŒ ì´ë²¤íŠ¸ íŠ¸ë˜í‚¹ ì‹¤íŒ¨:', error)}}trackPageView(pagePath, pageTitle){if (!this.isEnabled) return;try{if (this.analytics){this.analytics.logEvent('page_view',{page_path: pagePath, page_title: pageTitle})}if (this.ga){this.ga('config', 'GA_MEASUREMENT_ID',{page_path: pagePath, page_title: pageTitle})}}catch (error){console.error('âŒ í˜ì´ì§€ë·° íŠ¸ë˜í‚¹ ì‹¤íŒ¨:', error)}}setUserProperties(properties){if (!this.isEnabled) return;try{if (this.analytics){this.analytics.setUserProperties(properties)}if (this.ga){this.ga('set', 'user_properties', properties)}}catch (error){console.error('âŒ ì‚¬ìš©ì ì†ì„± ì„¤ì • ì‹¤íŒ¨:', error)}}trackPerformance(metricName, metrics){if (!this.isEnabled) return;try{this.trackEvent('performance',{metric_name: metricName, ...metrics})}catch (error){console.error('âŒ ì„±ëŠ¥ íŠ¸ë˜í‚¹ ì‹¤íŒ¨:', error)}}trackError(errorInfo){if (!this.isEnabled) return;try{const errorLog ={message: errorInfo.message || errorInfo.title || 'ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬', title: errorInfo.title || errorInfo.message, type: errorInfo.type || 'error', timestamp: errorInfo.timestamp || new Date().toISOString(), context: errorInfo.context ||{}, stack: errorInfo.stack || null, originalError: errorInfo.originalError || null, source: errorInfo.source || null, line: errorInfo.line || null, column: errorInfo.column || null, userAgent: typeof navigator !== 'undefined' ? navigator.userAgent : null, url: typeof window !== 'undefined' ? window.location.href : null};if (errorLog.stack && errorLog.stack.length > 1000){errorLog.stack = errorLog.stack.substring(0, 1000) + '... (truncated)'}if (this.analytics && typeof this.analytics.logEvent === 'function'){this.analytics.logEvent('error_occurred',{error_message: errorLog.message, error_type: errorLog.type, error_source: errorLog.source, error_line: errorLog.line, error_column: errorLog.column, has_stack: !!errorLog.stack, has_context: Object.keys(errorLog.context).length > 0})}if (this.ga){this.ga('event', 'exception',{description: errorLog.message, fatal: errorLog.type === 'error', error_type: errorLog.type})}console.error('ğŸš¨ ì—ëŸ¬ íŠ¸ë˜í‚¹:',{title: errorLog.title, message: errorLog.message, type: errorLog.type, timestamp: errorLog.timestamp, context: errorLog.context, stack: errorLog.stack, source: errorLog.source, line: errorLog.line, column: errorLog.column});if (this.firebaseMonitoring && typeof this.firebaseMonitoring.collectErrorLogs === 'function'){setTimeout(() =>{this.firebaseMonitoring.collectErrorLogs().catch(err =>{console.warn('âš ï¸ Firebase ì—ëŸ¬ ë¡œê·¸ ìˆ˜ì§‘ ì‹¤íŒ¨:', err)})}, 0)}}catch (error){console.error('âŒ ì—ëŸ¬ íŠ¸ë˜í‚¹ ì‹¤íŒ¨:',{error: error.message, stack: error.stack, originalErrorInfo: errorInfo})}}trackConversion(conversionName, conversionData ={}){if (!this.isEnabled) return;try{this.trackEvent('conversion',{conversion_name: conversionName, ...conversionData})}catch (error){console.error('âŒ ì „í™˜ íŠ¸ë˜í‚¹ ì‹¤íŒ¨:', error)}}trackUserFlow(flowName, step, data ={}){if (!this.isEnabled) return;try{this.trackEvent('user_flow',{flow_name: flowName, flow_step: step, ...data})}catch (error){console.error('âŒì‚¬ìš©ì í”Œë¡œìš° íŠ¸ë˜í‚¹ ì‹¤íŒ¨:', error)}}getFirstPaint(){const paintEntries = performance.getEntriesByType('paint');const firstPaint = paintEntries.find((entry) => entry.name === 'first-paint');return firstPaint ? Math.round(firstPaint.startTime) : 0}trackPromptCreated(promptData){this.trackEvent('prompt_created',{category: promptData.category, has_variables: promptData.variables?.length > 0, content_length: promptData.content?.length || 0});this.trackUserFlow('prompt_management', 'created')}trackPromptExecuted(executionData){this.trackEvent('prompt_executed',{llm_model: executionData.llmModel, has_variables: executionData.variables?.length > 0, execution_mode: executionData.executionMode});this.trackUserFlow('prompt_execution', 'executed')}trackRating(ratingData){this.trackEvent('rating_submitted',{rating: ratingData.rating, has_feedback: Boolean(ratingData.feedback), has_notes: Boolean(ratingData.notes)});this.trackUserFlow('prompt_execution', 'rated');if (ratingData.rating === 5){this.trackConversion('high_rating',{rating: 5})}}trackSearch(query, resultCount){this.trackEvent('search',{search_term: query, result_count: resultCount})}trackFilter(filters){this.trackEvent('filter_applied',{filter_count: Object.keys(filters).length, has_category: filters.categories?.length > 0, has_rating: filters.minRating > 0, has_date: Boolean(filters.dateRange)})}setEnabled(enabled){this.isEnabled = enabled}setupAlerts(){if (this.firebaseMonitoring){this.firebaseMonitoring.setupAlerts()}}async getDashboardData(){if (!this.firebaseMonitoring){console.error('âŒ Firebase ëª¨ë‹ˆí„°ë§ì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');return null}return await this.firebaseMonitoring.getDashboardData()}exportMetrics(){if (this.firebaseMonitoring){this.firebaseMonitoring.exportMetrics()}if (this.googleAnalytics){}}cleanup(){this.eventQueue = [];if (this.firebaseMonitoring){this.firebaseMonitoring.cleanup()}if (this.googleAnalytics){this.googleAnalytics.cleanup()}}}export default MonitoringManager;if (typeof module !== 'undefined' && module.exports){module.exports = MonitoringManager}