class TemplateEngine{constructor(){this.handlebars = null;this.compiledTemplates = new Map();this.maxCacheSize = 100;this._registerHelpers()}render(template, variables){try{if (!template || typeof template !== 'string'){throw new Error('템플릿은 문자열이어야 합니다.')}if (!variables || typeof variables !== 'object'){throw new Error('변수는 객체여야 합니다.')}this.validateVariables(template, variables);const cacheKey = this._getCacheKey(template);let compiled = this.compiledTemplates.get(cacheKey);if (!compiled){if (this.handlebars){compiled = this.handlebars.compile(template)}else{compiled = this._simpleCompile(template)}this._addToCache(cacheKey, compiled)}const result = typeof compiled === 'function' ? compiled(variables) : compiled(variables);return result}catch (error){console.error('❌ 템플릿 렌더링 실패:', error);throw new Error(`템플릿 렌더링에 실패했습니다: ${error.message}`)}}extractVariables(template){try{if (!template || typeof template !== 'string'){return []}const regex = /\{\{([^}]+)\}\}/g;const variables = new Set();let match;while ((match = regex.exec(template)) !== null){const varName = match[1].trim().split(' ')[0];if (!varName.startsWith('#') && !varName.startsWith('/')){variables.add(varName)}}return Array.from(variables)}catch (error){console.error('❌ 변수 추출 실패:', error);return []}}validateVariables(template, providedVariables){try{const requiredVars = this.extractVariables(template);const missingVars = requiredVars.filter((varName) => !(varName in providedVariables));if (missingVars.length > 0){throw new Error(`누락된 변수가 있습니다: ${missingVars.join(', ')}`)}return true}catch (error){console.error('❌ 변수 검증 실패:', error);throw error}}escapeHtml(text){if (!text || typeof text !== 'string'){return ''}const div = document.createElement('div');div.textContent = text;return div.innerHTML}_registerHelpers(){if (typeof Handlebars !== 'undefined'){this.handlebars = Handlebars.create();this.handlebars.registerHelper('uppercase', (str) =>{return str ? str.toUpperCase() : ''});this.handlebars.registerHelper('lowercase', (str) =>{return str ? str.toLowerCase() : ''});this.handlebars.registerHelper('truncate', (str, length) =>{if (!str) return '';return str.length > length ? str.substring(0, length) + '...' : str})}}_simpleCompile(template){return (variables) =>{let result = template;for (const [key, value] of Object.entries(variables)){const regex = new RegExp(`\\{\\{${key}\\}\\}`, 'g');result = result.replace(regex, this.escapeHtml(String(value)))}return result}}_getCacheKey(template){let hash = 0;for (let charIndex = 0;charIndex < template.length;charIndex++){const char = template.charCodeAt(charIndex);hash = (hash << 5) - hash + char;hash = hash & hash}return `template_${hash}`}_addToCache(key, compiled){if (this.compiledTemplates.size >= this.maxCacheSize){const firstKey = this.compiledTemplates.keys().next().value;this.compiledTemplates.delete(firstKey)}this.compiledTemplates.set(key, compiled)}clearCache(){this.compiledTemplates.clear()}}if (typeof module !== 'undefined' && module.exports){module.exports = TemplateEngine}