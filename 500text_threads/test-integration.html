<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google OAuth í†µí•© í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .header h1 {
            color: #333;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 1.1rem;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .test-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .test-section h2 {
            color: #667eea;
            font-size: 1.3rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .test-section p {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 140px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #000;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        .result-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .result-box.success {
            border-left-color: #28a745;
            background: #d4edda;
            color: #155724;
        }
        
        .result-box.error {
            border-left-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }
        
        .result-box.warning {
            border-left-color: #ffc107;
            background: #fff3cd;
            color: #856404;
        }
        
        .result-box.info {
            border-left-color: #17a2b8;
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-badge.pass {
            background: #d4edda;
            color: #155724;
        }
        
        .status-badge.fail {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-badge.running {
            background: #fff3cd;
            color: #856404;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
        }
        
        .test-summary {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .test-summary h2 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .summary-card {
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .summary-card.total {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .summary-card.passed {
            background: #d4edda;
            color: #155724;
        }
        
        .summary-card.failed {
            background: #f8d7da;
            color: #721c24;
        }
        
        .summary-card.skipped {
            background: #e2e3e5;
            color: #383d41;
        }
        
        .summary-card h3 {
            font-size: 2.5rem;
            margin-bottom: 5px;
        }
        
        .summary-card p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª Google OAuth í†µí•© í…ŒìŠ¤íŠ¸ Suite</h1>
            <p>Task 10.2: ì „ì²´ ì‹œìŠ¤í…œ í†µí•© í…ŒìŠ¤íŠ¸ - ëª¨ë“  ìš”êµ¬ì‚¬í•­ ê²€ì¦</p>
        </div>
        
        <div class="test-grid">
            <!-- Test 1: ì²« Google ë¡œê·¸ì¸ í”Œë¡œìš° -->
            <div class="test-section">
                <h2>1ï¸âƒ£ ì²« Google ë¡œê·¸ì¸ í”Œë¡œìš°</h2>
                <p>ì‹ ê·œ ì‚¬ìš©ìì˜ Google ë¡œê·¸ì¸ ì „ì²´ í”„ë¡œì„¸ìŠ¤ë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="runTest1()">ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
                    <button class="btn btn-info" onclick="runTest1Step1()">1ë‹¨ê³„: ì„¤ì • ê²€ì¦</button>
                    <button class="btn btn-info" onclick="runTest1Step2()">2ë‹¨ê³„: ì´ˆê¸°í™”</button>
                    <button class="btn btn-info" onclick="runTest1Step3()">3ë‹¨ê³„: ë¡œê·¸ì¸</button>
                    <button class="btn btn-info" onclick="runTest1Step4()">4ë‹¨ê³„: ì„¸ì…˜ ìœ ì§€</button>
                </div>
                <div id="test1-result" class="result-box" style="display: none;"></div>
            </div>
            
            <!-- Test 2: ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ì²´ í”„ë¡œì„¸ìŠ¤ -->
            <div class="test-section">
                <h2>2ï¸âƒ£ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ í”„ë¡œì„¸ìŠ¤</h2>
                <p>ê¸°ì¡´ ì‚¬ìš©ì ë°ì´í„°ë¥¼ Google ê³„ì •ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ì´ì „í•˜ëŠ” ì „ì²´ í”„ë¡œì„¸ìŠ¤ë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="runTest2()">ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
                    <button class="btn btn-info" onclick="runTest2Step1()">1ë‹¨ê³„: ê°ì§€</button>
                    <button class="btn btn-info" onclick="runTest2Step2()">2ë‹¨ê³„: ë°±ì—…</button>
                    <button class="btn btn-info" onclick="runTest2Step3()">3ë‹¨ê³„: ì´ì „</button>
                    <button class="btn btn-info" onclick="runTest2Step4()">4ë‹¨ê³„: ê²€ì¦</button>
                    <button class="btn btn-warning" onclick="runTest2Rollback()">ë¡¤ë°± í…ŒìŠ¤íŠ¸</button>
                </div>
                <div id="test2-result" class="result-box" style="display: none;"></div>
            </div>
            
            <!-- Test 3: í† í° ë§Œë£Œ ë° ìë™ ê°±ì‹  -->
            <div class="test-section">
                <h2>3ï¸âƒ£ í† í° ë§Œë£Œ ë° ìë™ ê°±ì‹ </h2>
                <p>í† í° ë§Œë£Œ ê°ì§€ ë° ìë™ ê°±ì‹  ë©”ì»¤ë‹ˆì¦˜ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="runTest3()">ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
                    <button class="btn btn-info" onclick="runTest3Step1()">1ë‹¨ê³„: í† í° ê²€ì¦</button>
                    <button class="btn btn-info" onclick="runTest3Step2()">2ë‹¨ê³„: ë§Œë£Œ ì‹œë®¬ë ˆì´ì…˜</button>
                    <button class="btn btn-info" onclick="runTest3Step3()">3ë‹¨ê³„: ìë™ ê°±ì‹ </button>
                    <button class="btn btn-info" onclick="runTest3Step4()">4ë‹¨ê³„: ì¬ìŠ¤ì¼€ì¤„ë§</button>
                </div>
                <div id="test3-result" class="result-box" style="display: none;"></div>
            </div>
            
            <!-- Test 4: ì—ëŸ¬ ë³µêµ¬ ì‹œë‚˜ë¦¬ì˜¤ -->
            <div class="test-section">
                <h2>4ï¸âƒ£ ì—ëŸ¬ ë³µêµ¬ ì‹œë‚˜ë¦¬ì˜¤</h2>
                <p>ë‹¤ì–‘í•œ ì—ëŸ¬ ìƒí™©ì—ì„œì˜ ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="runTest4()">ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
                    <button class="btn btn-warning" onclick="runTest4Config()">ì„¤ì • ì˜¤ë¥˜</button>
                    <button class="btn btn-warning" onclick="runTest4Network()">ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜</button>
                    <button class="btn btn-warning" onclick="runTest4Auth()">ì¸ì¦ ì˜¤ë¥˜</button>
                    <button class="btn btn-warning" onclick="runTest4Token()">í† í° ì˜¤ë¥˜</button>
                </div>
                <div id="test4-result" class="result-box" style="display: none;"></div>
            </div>
            
            <!-- Test 5: í´ë°± ì‹œìŠ¤í…œ -->
            <div class="test-section">
                <h2>5ï¸âƒ£ í´ë°± ì‹œìŠ¤í…œ</h2>
                <p>Google OAuth ì‹¤íŒ¨ ì‹œ í´ë°± ì‹œìŠ¤í…œ ì‘ë™ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="runTest5()">ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
                    <button class="btn btn-info" onclick="runTest5Offline()">ì˜¤í”„ë¼ì¸ í´ë°±</button>
                    <button class="btn btn-info" onclick="runTest5ConfigFail()">ì„¤ì • ì‹¤íŒ¨ í´ë°±</button>
                    <button class="btn btn-info" onclick="runTest5InitFail()">ì´ˆê¸°í™” ì‹¤íŒ¨ í´ë°±</button>
                    <button class="btn btn-success" onclick="runTest5Recovery()">ë³µêµ¬ í…ŒìŠ¤íŠ¸</button>
                </div>
                <div id="test5-result" class="result-box" style="display: none;"></div>
            </div>
            
            <!-- Test 6: ë³´ì•ˆ ê²€ì¦ -->
            <div class="test-section">
                <h2>6ï¸âƒ£ ë³´ì•ˆ ê²€ì¦</h2>
                <p>í† í° ì €ì¥, XSS ë°©ì§€, ë°ì´í„° ê²€ì¦ ë“± ë³´ì•ˆ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="runTest6()">ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
                    <button class="btn btn-info" onclick="runTest6TokenStorage()">í† í° ì €ì¥ ê²€ì¦</button>
                    <button class="btn btn-info" onclick="runTest6XSS()">XSS ë°©ì§€</button>
                    <button class="btn btn-info" onclick="runTest6DataValidation()">ë°ì´í„° ê²€ì¦</button>
                </div>
                <div id="test6-result" class="result-box" style="display: none;"></div>
            </div>
        </div>
        
        <!-- Test Summary -->
        <div class="test-summary">
            <h2>ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½</h2>
            <div class="summary-grid">
                <div class="summary-card total">
                    <h3 id="total-tests">0</h3>
                    <p>ì „ì²´ í…ŒìŠ¤íŠ¸</p>
                </div>
                <div class="summary-card passed">
                    <h3 id="passed-tests">0</h3>
                    <p>í†µê³¼</p>
                </div>
                <div class="summary-card failed">
                    <h3 id="failed-tests">0</h3>
                    <p>ì‹¤íŒ¨</p>
                </div>
                <div class="summary-card skipped">
                    <h3 id="skipped-tests">0</h3>
                    <p>ê±´ë„ˆëœ€</p>
                </div>
            </div>
            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
            </div>
            <div id="summary-details" class="result-box" style="margin-top: 20px;"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="config/auth-config.js"></script>
    <script src="js/security-utils.js"></script>
    <script src="js/error-handler.js"></script>
    <script src="js/activity-logger.js"></script>
    <script src="js/google-auth-manager.js"></script>
    <script src="js/data-migration-manager.js"></script>
    
    <script>
        // Test Suite State
        const testState = {
            total: 0,
            passed: 0,
            failed: 0,
            skipped: 0,
            results: []
        };
        
        // Initialize
        let authConfig, authManager, migrationManager, logger;
        
        document.addEventListener('DOMContentLoaded', () => {
            initializeTestSuite();
        });
        
        function initializeTestSuite() {
            try {
                authConfig = window.AUTH_CONFIG;
                logger = new ActivityLogger('test_user');
                authManager = new GoogleAuthManager(authConfig, logger);
                migrationManager = new DataMigrationManager(authConfig, logger);
                
                // Setup callbacks
                setupCallbacks();
                
                log('âœ… í…ŒìŠ¤íŠ¸ Suite ì´ˆê¸°í™” ì™„ë£Œ');
            } catch (error) {
                log('âŒ í…ŒìŠ¤íŠ¸ Suite ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }
        
        function setupCallbacks() {
            authManager.showMessage = (message, type) => {
                log(`[UI Message] ${message}`, type);
            };
            
            authManager.showSetupInstructions = () => {
                log('[Setup Instructions] ì„¤ì • ì•ˆë‚´ í‘œì‹œë¨', 'info');
            };
            
            authManager.enableFallback = () => {
                log('[Fallback] í´ë°± ì‹œìŠ¤í…œ í™œì„±í™”ë¨', 'warning');
            };
        }
        
        // Utility Functions
        function log(message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function showResult(testId, message, type = 'info') {
            const resultEl = document.getElementById(`${testId}-result`);
            if (resultEl) {
                resultEl.textContent = message;
                resultEl.className = `result-box ${type}`;
                resultEl.style.display = 'block';
            }
        }
        
        function updateTestStats(passed, failed = 0, skipped = 0) {
            testState.passed += passed;
            testState.failed += failed;
            testState.skipped += skipped;
            testState.total = testState.passed + testState.failed + testState.skipped;
            
            document.getElementById('total-tests').textContent = testState.total;
            document.getElementById('passed-tests').textContent = testState.passed;
            document.getElementById('failed-tests').textContent = testState.failed;
            document.getElementById('skipped-tests').textContent = testState.skipped;
            
            const progress = testState.total > 0 ? (testState.passed / testState.total) * 100 : 0;
            document.getElementById('progress-fill').style.width = progress + '%';
        }
        
        function addTestResult(testName, status, details) {
            testState.results.push({
                name: testName,
                status,
                details,
                timestamp: new Date().toISOString()
            });
            
            updateSummaryDetails();
        }
        
        function updateSummaryDetails() {
            const summaryEl = document.getElementById('summary-details');
            let html = '<strong>í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê¸°ë¡:</strong>\n\n';
            
            testState.results.forEach((result, index) => {
                const icon = result.status === 'pass' ? 'âœ…' : result.status === 'fail' ? 'âŒ' : 'â­ï¸';
                html += `${index + 1}. ${icon} ${result.name}\n`;
                if (result.details) {
                    html += `   ${result.details}\n`;
                }
            });
            
            summaryEl.textContent = html;
            summaryEl.style.display = 'block';
        }
        
        async function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // ===== TEST 1: ì²« Google ë¡œê·¸ì¸ í”Œë¡œìš° =====
        async function runTest1() {
            showResult('test1', 'í…ŒìŠ¤íŠ¸ 1 ì‹¤í–‰ ì¤‘...', 'info');
            
            try {
                await runTest1Step1();
                await sleep(1000);
                await runTest1Step2();
                await sleep(1000);
                
                showResult('test1', 
                    'âœ… í…ŒìŠ¤íŠ¸ 1 ì™„ë£Œ\n\n' +
                    '1ë‹¨ê³„: ì„¤ì • ê²€ì¦ âœ…\n' +
                    '2ë‹¨ê³„: OAuth ì´ˆê¸°í™” âœ…\n' +
                    '3ë‹¨ê³„: ë¡œê·¸ì¸ - ìˆ˜ë™ í…ŒìŠ¤íŠ¸ í•„ìš”\n' +
                    '4ë‹¨ê³„: ì„¸ì…˜ ìœ ì§€ - ë¡œê·¸ì¸ í›„ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥\n\n' +
                    'ğŸ’¡ ì‹¤ì œ ë¡œê·¸ì¸ì„ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ "3ë‹¨ê³„: ë¡œê·¸ì¸" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.',
                    'success'
                );
                
                addTestResult('Test 1: ì²« Google ë¡œê·¸ì¸ í”Œë¡œìš°', 'pass', 'ì„¤ì • ê²€ì¦ ë° ì´ˆê¸°í™” ì™„ë£Œ');
                updateTestStats(1);
                
            } catch (error) {
                showResult('test1', `âŒ í…ŒìŠ¤íŠ¸ 1 ì‹¤íŒ¨\n\n${error.message}`, 'error');
                addTestResult('Test 1: ì²« Google ë¡œê·¸ì¸ í”Œë¡œìš°', 'fail', error.message);
                updateTestStats(0, 1);
            }
        }
        
        async function runTest1Step1() {
            log('Test 1.1: ì„¤ì • ê²€ì¦ ì‹œì‘');
            
            const isValid = authConfig.validateGoogleConfig();
            
            if (!isValid) {
                const error = authConfig.getValidationError();
                throw new Error(`ì„¤ì • ê²€ì¦ ì‹¤íŒ¨: ${error.message}`);
            }
            
            log('âœ… Test 1.1: ì„¤ì • ê²€ì¦ í†µê³¼');
            showResult('test1', 'âœ… 1ë‹¨ê³„: ì„¤ì • ê²€ì¦ í†µê³¼', 'success');
        }
        
        async function runTest1Step2() {
            log('Test 1.2: OAuth ì´ˆê¸°í™” ì‹œì‘');
            
            const initialized = await authManager.initialize();
            
            if (!initialized) {
                throw new Error('OAuth ì´ˆê¸°í™” ì‹¤íŒ¨');
            }
            
            log('âœ… Test 1.2: OAuth ì´ˆê¸°í™” ì™„ë£Œ');
            showResult('test1', 'âœ… 2ë‹¨ê³„: OAuth ì´ˆê¸°í™” ì™„ë£Œ', 'success');
        }
        
        async function runTest1Step3() {
            log('Test 1.3: Google ë¡œê·¸ì¸ ì‹œì‘');
            
            try {
                showResult('test1', 'â³ 3ë‹¨ê³„: Google ë¡œê·¸ì¸ íŒì—… ëŒ€ê¸° ì¤‘...', 'info');
                
                const userData = await authManager.signIn();
                
                log('âœ… Test 1.3: ë¡œê·¸ì¸ ì„±ê³µ');
                showResult('test1', 
                    `âœ… 3ë‹¨ê³„: ë¡œê·¸ì¸ ì„±ê³µ\n\n` +
                    `ì‚¬ìš©ì: ${userData.name}\n` +
                    `ì´ë©”ì¼: ${userData.email}\n` +
                    `ë¡œê·¸ì¸ ì‹œê°„: ${new Date(userData.loginTime).toLocaleString()}`,
                    'success'
                );
                
                addTestResult('Test 1.3: Google ë¡œê·¸ì¸', 'pass', `ì‚¬ìš©ì: ${userData.email}`);
                updateTestStats(1);
                
            } catch (error) {
                log('âŒ Test 1.3: ë¡œê·¸ì¸ ì‹¤íŒ¨');
                showResult('test1', `âŒ 3ë‹¨ê³„: ë¡œê·¸ì¸ ì‹¤íŒ¨\n\n${error.message || error.error}`, 'error');
                addTestResult('Test 1.3: Google ë¡œê·¸ì¸', 'fail', error.message || error.error);
                updateTestStats(0, 1);
            }
        }
        
        async function runTest1Step4() {
            log('Test 1.4: ì„¸ì…˜ ìœ ì§€ í™•ì¸');
            
            const isSignedIn = authManager.isSignedIn();
            const currentUser = authManager.getCurrentUser();
            
            if (!isSignedIn || !currentUser) {
                showResult('test1', 'âŒ 4ë‹¨ê³„: ì„¸ì…˜ ì—†ìŒ - ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”', 'error');
                addTestResult('Test 1.4: ì„¸ì…˜ ìœ ì§€', 'fail', 'ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ');
                updateTestStats(0, 1);
                return;
            }
            
            const tokenValid = authManager.validateToken();
            
            showResult('test1',
                `âœ… 4ë‹¨ê³„: ì„¸ì…˜ ìœ ì§€ í™•ì¸\n\n` +
                `ë¡œê·¸ì¸ ìƒíƒœ: ${isSignedIn ? 'âœ…' : 'âŒ'}\n` +
                `ì‚¬ìš©ì: ${currentUser.name}\n` +
                `í† í° ìœ íš¨: ${tokenValid ? 'âœ…' : 'âŒ'}\n` +
                `ë§Œë£Œ ì‹œê°„: ${new Date(currentUser.expiresAt).toLocaleString()}`,
                'success'
            );
            
            addTestResult('Test 1.4: ì„¸ì…˜ ìœ ì§€', 'pass', 'ì„¸ì…˜ ì •ìƒ ìœ ì§€ ì¤‘');
            updateTestStats(1);
        }
        
        // ===== TEST 2: ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ì²´ í”„ë¡œì„¸ìŠ¤ =====
        async function runTest2() {
            showResult('test2', 'í…ŒìŠ¤íŠ¸ 2 ì‹¤í–‰ ì¤‘...', 'info');
            
            try {
                // í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
                createMigrationTestData();
                await sleep(500);
                
                await runTest2Step1();
                await sleep(500);
                await runTest2Step2();
                await sleep(500);
                await runTest2Step3();
                await sleep(500);
                await runTest2Step4();
                
                showResult('test2',
                    'âœ… í…ŒìŠ¤íŠ¸ 2 ì™„ë£Œ\n\n' +
                    '1ë‹¨ê³„: ë§ˆì´ê·¸ë ˆì´ì…˜ ê°ì§€ âœ…\n' +
                    '2ë‹¨ê³„: ë°±ì—… ìƒì„± âœ…\n' +
                    '3ë‹¨ê³„: ë°ì´í„° ì´ì „ âœ…\n' +
                    '4ë‹¨ê³„: ë°ì´í„° ê²€ì¦ âœ…\n\n' +
                    'ëª¨ë“  ë§ˆì´ê·¸ë ˆì´ì…˜ ë‹¨ê³„ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',
                    'success'
                );
                
                addTestResult('Test 2: ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜', 'pass', 'ì „ì²´ í”„ë¡œì„¸ìŠ¤ ì™„ë£Œ');
                updateTestStats(1);
                
            } catch (error) {
                showResult('test2', `âŒ í…ŒìŠ¤íŠ¸ 2 ì‹¤íŒ¨\n\n${error.message}`, 'error');
                addTestResult('Test 2: ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜', 'fail', error.message);
                updateTestStats(0, 1);
            }
        }
        
        function createMigrationTestData() {
            const testUsername = 'test_migration_user';
            const testData = [
                {
                    id: Date.now(),
                    content: 'ë§ˆì´ê·¸ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸ ê¸€ 1',
                    date: new Date().toLocaleString(),
                    characterCount: 15,
                    type: 'reference'
                },
                {
                    id: Date.now() + 1,
                    content: 'ë§ˆì´ê·¸ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸ ê¸€ 2',
                    date: new Date().toLocaleString(),
                    characterCount: 15,
                    type: 'edit'
                }
            ];
            
            localStorage.setItem(`dualTextWriter_savedTexts_${testUsername}`, JSON.stringify(testData));
            localStorage.setItem('dualTextWriter_currentUser', testUsername);
            localStorage.setItem('dualTextWriter_authProvider', 'username');
            
            log('âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì™„ë£Œ');
        }
        
        async function runTest2Step1() {
            log('Test 2.1: ë§ˆì´ê·¸ë ˆì´ì…˜ ê°ì§€');
            
            const googleUserData = {
                email: 'test_migration@example.com',
                name: 'Test Migration User'
            };
            
            const migrationInfo = migrationManager.checkMigrationNeeded(googleUserData);
            
            if (!migrationInfo.needed) {
                throw new Error('ë§ˆì´ê·¸ë ˆì´ì…˜ì´ í•„ìš”í•˜ì§€ ì•ŠìŒ (í…ŒìŠ¤íŠ¸ ë°ì´í„° í™•ì¸ í•„ìš”)');
            }
            
            log('âœ… Test 2.1: ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš”ì„± ê°ì§€ ì™„ë£Œ');
            showResult('test2',
                `âœ… 1ë‹¨ê³„: ë§ˆì´ê·¸ë ˆì´ì…˜ ê°ì§€\n\n` +
                `ê¸°ì¡´ ì‚¬ìš©ì: ${migrationInfo.oldUsername}\n` +
                `ìƒˆ ì´ë©”ì¼: ${migrationInfo.newEmail}\n` +
                `ë°ì´í„° ê°œìˆ˜: ${migrationInfo.dataCount}ê°œ`,
                'success'
            );
        }
        
        async function runTest2Step2() {
            log('Test 2.2: ë°±ì—… ìƒì„±');
            
            const testUsername = 'test_migration_user';
            const userData = migrationManager.getExistingUserData(testUsername);
            const backup = migrationManager.createBackup(userData);
            
            if (!backup) {
                throw new Error('ë°±ì—… ìƒì„± ì‹¤íŒ¨');
            }
            
            log('âœ… Test 2.2: ë°±ì—… ìƒì„± ì™„ë£Œ');
            showResult('test2',
                `âœ… 2ë‹¨ê³„: ë°±ì—… ìƒì„±\n\n` +
                `ë°±ì—… ì‹œê°„: ${new Date(backup.timestamp).toLocaleString()}\n` +
                `ì²´í¬ì„¬: ${backup.checksum}\n` +
                `ë°ì´í„° ê°œìˆ˜: ${backup.data.savedTexts.length}ê°œ`,
                'success'
            );
        }
        
        async function runTest2Step3() {
            log('Test 2.3: ë°ì´í„° ì´ì „');
            
            const oldUsername = 'test_migration_user';
            const newEmail = 'test_migration@example.com';
            
            const result = await migrationManager.performMigration(oldUsername, newEmail);
            
            if (!result.success) {
                throw new Error('ë°ì´í„° ì´ì „ ì‹¤íŒ¨');
            }
            
            log('âœ… Test 2.3: ë°ì´í„° ì´ì „ ì™„ë£Œ');
            showResult('test2',
                `âœ… 3ë‹¨ê³„: ë°ì´í„° ì´ì „\n\n` +
                `ë§ˆì´ê·¸ë ˆì´ì…˜ ID: ${result.migrationRecord.migrationId}\n` +
                `ì´ì „ëœ ë°ì´í„°: ${result.migrationRecord.dataCount}ê°œ\n` +
                `ì™„ë£Œ ì‹œê°„: ${new Date(result.migrationRecord.migratedAt).toLocaleString()}`,
                'success'
            );
        }
        
        async function runTest2Step4() {
            log('Test 2.4: ë°ì´í„° ê²€ì¦');
            
            const newEmail = 'test_migration@example.com';
            const migratedData = JSON.parse(
                localStorage.getItem(`dualTextWriter_savedTexts_${newEmail}`) || '[]'
            );
            
            if (migratedData.length === 0) {
                throw new Error('ì´ì „ëœ ë°ì´í„°ê°€ ì—†ìŒ');
            }
            
            log('âœ… Test 2.4: ë°ì´í„° ê²€ì¦ ì™„ë£Œ');
            showResult('test2',
                `âœ… 4ë‹¨ê³„: ë°ì´í„° ê²€ì¦\n\n` +
                `ê²€ì¦ëœ ë°ì´í„°: ${migratedData.length}ê°œ\n` +
                `ë°ì´í„° ë¬´ê²°ì„±: âœ… í™•ì¸ë¨`,
                'success'
            );
        }
        
        async function runTest2Rollback() {
            log('Test 2.5: ë¡¤ë°± í…ŒìŠ¤íŠ¸');
            
            try {
                const success = await migrationManager.rollbackMigration();
                
                if (!success) {
                    throw new Error('ë¡¤ë°± ì‹¤íŒ¨');
                }
                
                showResult('test2', 'âœ… ë¡¤ë°± í…ŒìŠ¤íŠ¸ ì„±ê³µ\n\në°±ì—…ì—ì„œ ë°ì´í„°ê°€ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                addTestResult('Test 2.5: ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡¤ë°±', 'pass', 'ë¡¤ë°± ì„±ê³µ');
                updateTestStats(1);
                
            } catch (error) {
                showResult('test2', `âŒ ë¡¤ë°± í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨\n\n${error.message}`, 'error');
                addTestResult('Test 2.5: ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡¤ë°±', 'fail', error.message);
                updateTestStats(0, 1);
            }
        }
        
        // ===== TEST 3: í† í° ë§Œë£Œ ë° ìë™ ê°±ì‹  =====
        async function runTest3() {
            showResult('test3', 'í…ŒìŠ¤íŠ¸ 3 ì‹¤í–‰ ì¤‘...', 'info');
            
            try {
                await runTest3Step1();
                await sleep(1000);
                
                showResult('test3',
                    'âœ… í…ŒìŠ¤íŠ¸ 3 ë¶€ë¶„ ì™„ë£Œ\n\n' +
                    '1ë‹¨ê³„: í† í° ê²€ì¦ âœ…\n' +
                    '2ë‹¨ê³„: ë§Œë£Œ ì‹œë®¬ë ˆì´ì…˜ - ìˆ˜ë™ í…ŒìŠ¤íŠ¸ í•„ìš”\n' +
                    '3ë‹¨ê³„: ìë™ ê°±ì‹  - ë¡œê·¸ì¸ í›„ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥\n' +
                    '4ë‹¨ê³„: ì¬ìŠ¤ì¼€ì¤„ë§ - ê°±ì‹  í›„ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥\n\n' +
                    'ğŸ’¡ ì‹¤ì œ í† í° ê°±ì‹ ì„ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.',
                    'success'
                );
                
                addTestResult('Test 3: í† í° ê´€ë¦¬', 'pass', 'í† í° ê²€ì¦ ì™„ë£Œ');
                updateTestStats(1);
                
            } catch (error) {
                showResult('test3', `âŒ í…ŒìŠ¤íŠ¸ 3 ì‹¤íŒ¨\n\n${error.message}`, 'error');
                addTestResult('Test 3: í† í° ê´€ë¦¬', 'fail', error.message);
                updateTestStats(0, 1);
            }
        }
        
        async function runTest3Step1() {
            log('Test 3.1: í† í° ê²€ì¦');
            
            const isSignedIn = authManager.isSignedIn();
            
            if (!isSignedIn) {
                log('âš ï¸ Test 3.1: ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ (ì •ìƒ)');
                showResult('test3', 'â„¹ï¸ 1ë‹¨ê³„: ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ\n\ní† í° ê²€ì¦ì„ ìœ„í•´ ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.', 'info');
                return;
            }
            
            const tokenValid = authManager.validateToken();
            const currentUser = authManager.getCurrentUser();
            
            log('âœ… Test 3.1: í† í° ê²€ì¦ ì™„ë£Œ');
            showResult('test3',
                `âœ… 1ë‹¨ê³„: í† í° ê²€ì¦\n\n` +
                `í† í° ìœ íš¨: ${tokenValid ? 'âœ…' : 'âŒ'}\n` +
                `ë§Œë£Œ ì‹œê°„: ${new Date(currentUser.expiresAt).toLocaleString()}\n` +
                `ë‚¨ì€ ì‹œê°„: ${Math.floor((currentUser.expiresAt - Date.now()) / 60000)}ë¶„`,
                'success'
            );
        }
        
        async function runTest3Step2() {
            log('Test 3.2: í† í° ë§Œë£Œ ì‹œë®¬ë ˆì´ì…˜');
            
            if (!authManager.tokenData) {
                showResult('test3', 'âŒ 2ë‹¨ê³„: ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ\n\në¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.', 'error');
                addTestResult('Test 3.2: í† í° ë§Œë£Œ ì‹œë®¬ë ˆì´ì…˜', 'fail', 'ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ');
                updateTestStats(0, 1);
                return;
            }
            
            const originalExpiry = authManager.tokenData.expiresAt;
            authManager.tokenData.expiresAt = Date.now() - 1000; // ê³¼ê±°ë¡œ ì„¤ì •
            
            const isExpired = !authManager.validateToken();
            
            showResult('test3',
                `âœ… 2ë‹¨ê³„: í† í° ë§Œë£Œ ì‹œë®¬ë ˆì´ì…˜\n\n` +
                `ì›ë˜ ë§Œë£Œ ì‹œê°„: ${new Date(originalExpiry).toLocaleString()}\n` +
                `ì‹œë®¬ë ˆì´ì…˜ ë§Œë£Œ ì‹œê°„: ${new Date(authManager.tokenData.expiresAt).toLocaleString()}\n` +
                `í† í° ë§Œë£Œ í™•ì¸: ${isExpired ? 'âœ…' : 'âŒ'}\n\n` +
                `5ì´ˆ í›„ ì›ë˜ ì‹œê°„ìœ¼ë¡œ ë³µêµ¬ë©ë‹ˆë‹¤...`,
                'success'
            );
            
            // 5ì´ˆ í›„ ë³µêµ¬
            setTimeout(() => {
                if (authManager.tokenData) {
                    authManager.tokenData.expiresAt = originalExpiry;
                    log('âœ… í† í° ë§Œë£Œ ì‹œê°„ ë³µêµ¬ë¨');
                }
            }, 5000);
            
            addTestResult('Test 3.2: í† í° ë§Œë£Œ ì‹œë®¬ë ˆì´ì…˜', 'pass', 'ë§Œë£Œ ê°ì§€ ì„±ê³µ');
            updateTestStats(1);
        }
        
        async function runTest3Step3() {
            log('Test 3.3: í† í° ìë™ ê°±ì‹ ');
            
            try {
                showResult('test3', 'â³ 3ë‹¨ê³„: í† í° ê°±ì‹  ì¤‘...', 'info');
                
                const tokenData = await authManager.refreshToken();
                
                if (!tokenData) {
                    throw new Error('í† í° ê°±ì‹  ì‹¤íŒ¨');
                }
                
                log('âœ… Test 3.3: í† í° ê°±ì‹  ì™„ë£Œ');
                showResult('test3',
                    `âœ… 3ë‹¨ê³„: í† í° ìë™ ê°±ì‹ \n\n` +
                    `ê°±ì‹  ì‹œê°„: ${new Date().toLocaleString()}\n` +
                    `ìƒˆ ë§Œë£Œ ì‹œê°„: ${new Date(tokenData.expiresAt).toLocaleString()}\n` +
                    `ìœ íš¨ ê¸°ê°„: ${Math.floor((tokenData.expiresAt - Date.now()) / 60000)}ë¶„`,
                    'success'
                );
                
                addTestResult('Test 3.3: í† í° ìë™ ê°±ì‹ ', 'pass', 'ê°±ì‹  ì„±ê³µ');
                updateTestStats(1);
                
            } catch (error) {
                showResult('test3', `âŒ 3ë‹¨ê³„: í† í° ê°±ì‹  ì‹¤íŒ¨\n\n${error.message || error.error}`, 'error');
                addTestResult('Test 3.3: í† í° ìë™ ê°±ì‹ ', 'fail', error.message || error.error);
                updateTestStats(0, 1);
            }
        }
        
        async function runTest3Step4() {
            log('Test 3.4: í† í° ê°±ì‹  ì¬ìŠ¤ì¼€ì¤„ë§');
            
            if (!authManager.tokenData) {
                showResult('test3', 'âŒ 4ë‹¨ê³„: ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ\n\në¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.', 'error');
                addTestResult('Test 3.4: ì¬ìŠ¤ì¼€ì¤„ë§', 'fail', 'ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ');
                updateTestStats(0, 1);
                return;
            }
            
            const expiresAt = authManager.tokenData.expiresAt;
            const refreshTime = expiresAt - (5 * 60 * 1000); // 5ë¶„ ì „
            const timeUntilRefresh = refreshTime - Date.now();
            
            showResult('test3',
                `âœ… 4ë‹¨ê³„: í† í° ê°±ì‹  ì¬ìŠ¤ì¼€ì¤„ë§\n\n` +
                `í† í° ë§Œë£Œ ì‹œê°„: ${new Date(expiresAt).toLocaleString()}\n` +
                `ìë™ ê°±ì‹  ì˜ˆì • ì‹œê°„: ${new Date(refreshTime).toLocaleString()}\n` +
                `ê°±ì‹ ê¹Œì§€ ë‚¨ì€ ì‹œê°„: ${Math.floor(timeUntilRefresh / 60000)}ë¶„\n` +
                `ìŠ¤ì¼€ì¤„ë§ ìƒíƒœ: ${authManager.tokenRefreshTimeout ? 'âœ… í™œì„±' : 'âŒ ë¹„í™œì„±'}`,
                'success'
            );
            
            addTestResult('Test 3.4: ì¬ìŠ¤ì¼€ì¤„ë§', 'pass', 'ìŠ¤ì¼€ì¤„ë§ í™•ì¸ ì™„ë£Œ');
            updateTestStats(1);
        }
        
        // ===== TEST 4: ì—ëŸ¬ ë³µêµ¬ ì‹œë‚˜ë¦¬ì˜¤ =====
        async function runTest4() {
            showResult('test4', 'í…ŒìŠ¤íŠ¸ 4 ì‹¤í–‰ ì¤‘...', 'info');
            
            try {
                await runTest4Config();
                await sleep(1000);
                await runTest4Network();
                await sleep(1000);
                await runTest4Auth();
                await sleep(1000);
                await runTest4Token();
                
                showResult('test4',
                    'âœ… í…ŒìŠ¤íŠ¸ 4 ì™„ë£Œ\n\n' +
                    'ì„¤ì • ì˜¤ë¥˜ ë³µêµ¬ âœ…\n' +
                    'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë³µêµ¬ âœ…\n' +
                    'ì¸ì¦ ì˜¤ë¥˜ ë³µêµ¬ âœ…\n' +
                    'í† í° ì˜¤ë¥˜ ë³µêµ¬ âœ…\n\n' +
                    'ëª¨ë“  ì—ëŸ¬ ë³µêµ¬ ì‹œë‚˜ë¦¬ì˜¤ê°€ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.',
                    'success'
                );
                
                addTestResult('Test 4: ì—ëŸ¬ ë³µêµ¬', 'pass', 'ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ ì™„ë£Œ');
                updateTestStats(1);
                
            } catch (error) {
                showResult('test4', `âŒ í…ŒìŠ¤íŠ¸ 4 ì‹¤íŒ¨\n\n${error.message}`, 'error');
                addTestResult('Test 4: ì—ëŸ¬ ë³µêµ¬', 'fail', error.message);
                updateTestStats(0, 1);
            }
        }
        
        async function runTest4Config() {
            log('Test 4.1: ì„¤ì • ì˜¤ë¥˜ ë³µêµ¬');
            
            const error = {
                error: 'config_validation_failed',
                message: 'ì„¤ì • ê²€ì¦ ì‹¤íŒ¨ (ì‹œë®¬ë ˆì´ì…˜)'
            };
            
            const result = authManager.handleAuthError(error);
            
            showResult('test4',
                `âœ… ì„¤ì • ì˜¤ë¥˜ ë³µêµ¬ í…ŒìŠ¤íŠ¸\n\n` +
                `ì—ëŸ¬ ì¹´í…Œê³ ë¦¬: ${result.category}\n` +
                `ì—ëŸ¬ ì½”ë“œ: ${result.code}\n` +
                `ì‚¬ìš©ì ë©”ì‹œì§€: ${result.userMessage}\n` +
                `ì•¡ì…˜: ${result.action}\n` +
                `ì²˜ë¦¬ ì™„ë£Œ: ${result.handled ? 'âœ…' : 'âŒ'}`,
                'success'
            );
            
            addTestResult('Test 4.1: ì„¤ì • ì˜¤ë¥˜ ë³µêµ¬', 'pass', 'ì—ëŸ¬ ì²˜ë¦¬ ì™„ë£Œ');
            updateTestStats(1);
        }
        
        async function runTest4Network() {
            log('Test 4.2: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë³µêµ¬');
            
            const error = {
                error: 'network_error',
                message: 'ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹¤íŒ¨ (ì‹œë®¬ë ˆì´ì…˜)'
            };
            
            const result = authManager.handleAuthError(error);
            
            showResult('test4',
                `âœ… ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë³µêµ¬ í…ŒìŠ¤íŠ¸\n\n` +
                `ì—ëŸ¬ ì¹´í…Œê³ ë¦¬: ${result.category}\n` +
                `ì—ëŸ¬ ì½”ë“œ: ${result.code}\n` +
                `ì‚¬ìš©ì ë©”ì‹œì§€: ${result.userMessage}\n` +
                `ì•¡ì…˜: ${result.action}\n` +
                `ì²˜ë¦¬ ì™„ë£Œ: ${result.handled ? 'âœ…' : 'âŒ'}`,
                'success'
            );
            
            addTestResult('Test 4.2: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë³µêµ¬', 'pass', 'ì—ëŸ¬ ì²˜ë¦¬ ì™„ë£Œ');
            updateTestStats(1);
        }
        
        async function runTest4Auth() {
            log('Test 4.3: ì¸ì¦ ì˜¤ë¥˜ ë³µêµ¬');
            
            const error = {
                error: 'popup_closed_by_user',
                message: 'ì‚¬ìš©ìê°€ íŒì—…ì„ ë‹«ìŒ (ì‹œë®¬ë ˆì´ì…˜)'
            };
            
            const result = authManager.handleAuthError(error);
            
            showResult('test4',
                `âœ… ì¸ì¦ ì˜¤ë¥˜ ë³µêµ¬ í…ŒìŠ¤íŠ¸\n\n` +
                `ì—ëŸ¬ ì¹´í…Œê³ ë¦¬: ${result.category}\n` +
                `ì—ëŸ¬ ì½”ë“œ: ${result.code}\n` +
                `ì‚¬ìš©ì ë©”ì‹œì§€: ${result.userMessage}\n` +
                `ì•¡ì…˜: ${result.action}\n` +
                `ì²˜ë¦¬ ì™„ë£Œ: ${result.handled ? 'âœ…' : 'âŒ'}`,
                'success'
            );
            
            addTestResult('Test 4.3: ì¸ì¦ ì˜¤ë¥˜ ë³µêµ¬', 'pass', 'ì—ëŸ¬ ì²˜ë¦¬ ì™„ë£Œ');
            updateTestStats(1);
        }
        
        async function runTest4Token() {
            log('Test 4.4: í† í° ì˜¤ë¥˜ ë³µêµ¬');
            
            const error = {
                error: 'token_expired',
                message: 'í† í° ë§Œë£Œ (ì‹œë®¬ë ˆì´ì…˜)'
            };
            
            const result = authManager.handleAuthError(error);
            
            showResult('test4',
                `âœ… í† í° ì˜¤ë¥˜ ë³µêµ¬ í…ŒìŠ¤íŠ¸\n\n` +
                `ì—ëŸ¬ ì¹´í…Œê³ ë¦¬: ${result.category}\n` +
                `ì—ëŸ¬ ì½”ë“œ: ${result.code}\n` +
                `ì‚¬ìš©ì ë©”ì‹œì§€: ${result.userMessage}\n` +
                `ì•¡ì…˜: ${result.action}\n` +
                `ì²˜ë¦¬ ì™„ë£Œ: ${result.handled ? 'âœ…' : 'âŒ'}`,
                'success'
            );
            
            addTestResult('Test 4.4: í† í° ì˜¤ë¥˜ ë³µêµ¬', 'pass', 'ì—ëŸ¬ ì²˜ë¦¬ ì™„ë£Œ');
            updateTestStats(1);
        }
        
        // ===== TEST 5: í´ë°± ì‹œìŠ¤í…œ =====
        async function runTest5() {
            showResult('test5', 'í…ŒìŠ¤íŠ¸ 5 ì‹¤í–‰ ì¤‘...', 'info');
            
            try {
                await runTest5Offline();
                await sleep(1000);
                await runTest5ConfigFail();
                await sleep(1000);
                await runTest5InitFail();
                
                showResult('test5',
                    'âœ… í…ŒìŠ¤íŠ¸ 5 ì™„ë£Œ\n\n' +
                    'ì˜¤í”„ë¼ì¸ í´ë°± âœ…\n' +
                    'ì„¤ì • ì‹¤íŒ¨ í´ë°± âœ…\n' +
                    'ì´ˆê¸°í™” ì‹¤íŒ¨ í´ë°± âœ…\n\n' +
                    'ëª¨ë“  í´ë°± ì‹œë‚˜ë¦¬ì˜¤ê°€ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.',
                    'success'
                );
                
                addTestResult('Test 5: í´ë°± ì‹œìŠ¤í…œ', 'pass', 'ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ ì™„ë£Œ');
                updateTestStats(1);
                
            } catch (error) {
                showResult('test5', `âŒ í…ŒìŠ¤íŠ¸ 5 ì‹¤íŒ¨\n\n${error.message}`, 'error');
                addTestResult('Test 5: í´ë°± ì‹œìŠ¤í…œ', 'fail', error.message);
                updateTestStats(0, 1);
            }
        }
        
        async function runTest5Offline() {
            log('Test 5.1: ì˜¤í”„ë¼ì¸ í´ë°±');
            
            const isOnline = navigator.onLine;
            
            showResult('test5',
                `âœ… ì˜¤í”„ë¼ì¸ í´ë°± í…ŒìŠ¤íŠ¸\n\n` +
                `í˜„ì¬ ë„¤íŠ¸ì›Œí¬ ìƒíƒœ: ${isOnline ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'}\n` +
                `í´ë°± í™œì„±í™” ì¡°ê±´: ì˜¤í”„ë¼ì¸ ìƒíƒœ\n` +
                `ì˜ˆìƒ ë™ì‘: ì‚¬ìš©ìëª… ë¡œê·¸ì¸ë§Œ í‘œì‹œ\n\n` +
                `ğŸ’¡ ì‹¤ì œ ì˜¤í”„ë¼ì¸ í…ŒìŠ¤íŠ¸:\n` +
                `1. ê°œë°œì ë„êµ¬ (F12) ì—´ê¸°\n` +
                `2. Network íƒ­ > Offline ì²´í¬\n` +
                `3. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨`,
                'success'
            );
            
            addTestResult('Test 5.1: ì˜¤í”„ë¼ì¸ í´ë°±', 'pass', `ë„¤íŠ¸ì›Œí¬ ìƒíƒœ: ${isOnline ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'}`);
            updateTestStats(1);
        }
        
        async function runTest5ConfigFail() {
            log('Test 5.2: ì„¤ì • ì‹¤íŒ¨ í´ë°±');
            
            const fallbackConfig = authConfig.getFallbackConfig();
            
            showResult('test5',
                `âœ… ì„¤ì • ì‹¤íŒ¨ í´ë°± í…ŒìŠ¤íŠ¸\n\n` +
                `í´ë°± ë¡œê·¸ì¸ í™œì„±í™”: ${fallbackConfig.enableFallbackLogin ? 'âœ…' : 'âŒ'}\n` +
                `ì„¤ì • ì•ˆë‚´ í‘œì‹œ: ${fallbackConfig.showSetupInstructions ? 'âœ…' : 'âŒ'}\n` +
                `ì˜¤í”„ë¼ì¸ ëª¨ë“œ í—ˆìš©: ${fallbackConfig.allowOfflineMode ? 'âœ…' : 'âŒ'}\n` +
                `í´ë°± ë©”ì‹œì§€: ${fallbackConfig.fallbackMessage}\n\n` +
                `ì˜ˆìƒ ë™ì‘: ì„¤ì • ì•ˆë‚´ í‘œì‹œ í›„ í´ë°± í™œì„±í™”`,
                'success'
            );
            
            addTestResult('Test 5.2: ì„¤ì • ì‹¤íŒ¨ í´ë°±', 'pass', 'í´ë°± ì„¤ì • í™•ì¸ ì™„ë£Œ');
            updateTestStats(1);
        }
        
        async function runTest5InitFail() {
            log('Test 5.3: ì´ˆê¸°í™” ì‹¤íŒ¨ í´ë°±');
            
            const error = {
                error: 'initialization_failed',
                message: 'Google OAuth ì´ˆê¸°í™” ì‹¤íŒ¨ (ì‹œë®¬ë ˆì´ì…˜)'
            };
            
            const result = authManager.handleAuthError(error);
            
            showResult('test5',
                `âœ… ì´ˆê¸°í™” ì‹¤íŒ¨ í´ë°± í…ŒìŠ¤íŠ¸\n\n` +
                `ì—ëŸ¬ ì²˜ë¦¬: ${result.handled ? 'âœ…' : 'âŒ'}\n` +
                `í´ë°± í™œì„±í™”: ${result.action === 'enable_fallback' ? 'âœ…' : 'âŒ'}\n` +
                `ì‚¬ìš©ì ë©”ì‹œì§€: ${result.userMessage}\n\n` +
                `ì˜ˆìƒ ë™ì‘: í´ë°± ì‹œìŠ¤í…œìœ¼ë¡œ ìë™ ì „í™˜`,
                'success'
            );
            
            addTestResult('Test 5.3: ì´ˆê¸°í™” ì‹¤íŒ¨ í´ë°±', 'pass', 'í´ë°± ì „í™˜ í™•ì¸ ì™„ë£Œ');
            updateTestStats(1);
        }
        
        async function runTest5Recovery() {
            log('Test 5.4: í´ë°±ì—ì„œ ë³µêµ¬');
            
            const isOnline = navigator.onLine;
            
            if (!isOnline) {
                showResult('test5',
                    `âš ï¸ ë³µêµ¬ í…ŒìŠ¤íŠ¸\n\n` +
                    `í˜„ì¬ ìƒíƒœ: ì˜¤í”„ë¼ì¸\n` +
                    `ë³µêµ¬ ì¡°ê±´: ì˜¨ë¼ì¸ ë³µêµ¬ í•„ìš”\n\n` +
                    `ğŸ’¡ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ ë³µêµ¬í•˜ë©´ ìë™ìœ¼ë¡œ Google OAuthê°€ ì¬í™œì„±í™”ë©ë‹ˆë‹¤.`,
                    'warning'
                );
                addTestResult('Test 5.4: í´ë°± ë³µêµ¬', 'skip', 'ì˜¤í”„ë¼ì¸ ìƒíƒœ');
                updateTestStats(0, 0, 1);
                return;
            }
            
            showResult('test5',
                `âœ… ë³µêµ¬ í…ŒìŠ¤íŠ¸\n\n` +
                `í˜„ì¬ ìƒíƒœ: ì˜¨ë¼ì¸\n` +
                `Google OAuth ìƒíƒœ: ${authManager.isInitialized ? 'ì´ˆê¸°í™”ë¨' : 'ë¯¸ì´ˆê¸°í™”'}\n\n` +
                `ì˜ˆìƒ ë™ì‘: ì˜¨ë¼ì¸ ë³µêµ¬ ì‹œ Google OAuth ì¬í™œì„±í™”`,
                'success'
            );
            
            addTestResult('Test 5.4: í´ë°± ë³µêµ¬', 'pass', 'ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜ í™•ì¸ ì™„ë£Œ');
            updateTestStats(1);
        }
        
        // ===== TEST 6: ë³´ì•ˆ ê²€ì¦ =====
        async function runTest6() {
            showResult('test6', 'í…ŒìŠ¤íŠ¸ 6 ì‹¤í–‰ ì¤‘...', 'info');
            
            try {
                await runTest6TokenStorage();
                await sleep(1000);
                await runTest6XSS();
                await sleep(1000);
                await runTest6DataValidation();
                
                showResult('test6',
                    'âœ… í…ŒìŠ¤íŠ¸ 6 ì™„ë£Œ\n\n' +
                    'í† í° ì €ì¥ ë³´ì•ˆ âœ…\n' +
                    'XSS ë°©ì§€ âœ…\n' +
                    'ë°ì´í„° ê²€ì¦ âœ…\n\n' +
                    'ëª¨ë“  ë³´ì•ˆ ê¸°ëŠ¥ì´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.',
                    'success'
                );
                
                addTestResult('Test 6: ë³´ì•ˆ ê²€ì¦', 'pass', 'ì „ì²´ ë³´ì•ˆ ê²€ì¦ ì™„ë£Œ');
                updateTestStats(1);
                
            } catch (error) {
                showResult('test6', `âŒ í…ŒìŠ¤íŠ¸ 6 ì‹¤íŒ¨\n\n${error.message}`, 'error');
                addTestResult('Test 6: ë³´ì•ˆ ê²€ì¦', 'fail', error.message);
                updateTestStats(0, 1);
            }
        }
        
        async function runTest6TokenStorage() {
            log('Test 6.1: í† í° ì €ì¥ ë³´ì•ˆ ê²€ì¦');
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— í† í°ì´ ì €ì¥ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            const hasTokenInStorage = localStorage.getItem('dualTextWriter_accessToken') !== null ||
                                     localStorage.getItem('dualTextWriter_tokenData') !== null;
            
            // ë©”ëª¨ë¦¬ì—ë§Œ í† í°ì´ ìˆëŠ”ì§€ í™•ì¸
            const hasTokenInMemory = authManager.tokenData !== null;
            
            const isSecure = !hasTokenInStorage; // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì—†ì–´ì•¼ ì•ˆì „
            
            showResult('test6',
                `${isSecure ? 'âœ…' : 'âŒ'} í† í° ì €ì¥ ë³´ì•ˆ ê²€ì¦\n\n` +
                `ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— í† í°: ${hasTokenInStorage ? 'âŒ ìˆìŒ (ë³´ì•ˆ ìœ„í—˜!)' : 'âœ… ì—†ìŒ (ì•ˆì „)'}\n` +
                `ë©”ëª¨ë¦¬ì— í† í°: ${hasTokenInMemory ? 'âœ… ìˆìŒ' : 'â„¹ï¸ ì—†ìŒ (ë¡œê·¸ì¸ í•„ìš”)'}\n\n` +
                `ë³´ì•ˆ ìš”êµ¬ì‚¬í•­:\n` +
                `- Access Tokenì€ ë©”ëª¨ë¦¬ì—ë§Œ ì €ì¥ âœ…\n` +
                `- ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ëŠ” ë¹„ë¯¼ê° ì •ë³´ë§Œ ì €ì¥ âœ…\n` +
                `- í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ í† í° ì‚­ì œ âœ…`,
                isSecure ? 'success' : 'error'
            );
            
            addTestResult('Test 6.1: í† í° ì €ì¥ ë³´ì•ˆ', isSecure ? 'pass' : 'fail', 
                         isSecure ? 'í† í°ì´ ì•ˆì „í•˜ê²Œ ë©”ëª¨ë¦¬ì—ë§Œ ì €ì¥ë¨' : 'í† í°ì´ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë…¸ì¶œë¨');
            updateTestStats(isSecure ? 1 : 0, isSecure ? 0 : 1);
        }
        
        async function runTest6XSS() {
            log('Test 6.2: XSS ë°©ì§€ ê²€ì¦');
            
            const securityUtils = new SecurityUtils();
            
            // XSS ê³µê²© ì‹œë„ í…ŒìŠ¤íŠ¸
            const maliciousInputs = [
                '<script>alert("XSS")</script>',
                '<img src=x onerror="alert(1)">',
                'javascript:alert(1)',
                '<svg onload="alert(1)">'
            ];
            
            let allSafe = true;
            const results = [];
            
            maliciousInputs.forEach(input => {
                const escaped = securityUtils.escapeHtml(input);
                const isSafe = !escaped.includes('<script') && !escaped.includes('onerror') && 
                              !escaped.includes('javascript:') && !escaped.includes('onload');
                
                results.push(`ì…ë ¥: ${input.substring(0, 30)}...\nì´ìŠ¤ì¼€ì´í”„: ${escaped.substring(0, 50)}...\nì•ˆì „: ${isSafe ? 'âœ…' : 'âŒ'}`);
                
                if (!isSafe) allSafe = false;
            });
            
            showResult('test6',
                `${allSafe ? 'âœ…' : 'âŒ'} XSS ë°©ì§€ ê²€ì¦\n\n` +
                `í…ŒìŠ¤íŠ¸ëœ ê³µê²© íŒ¨í„´: ${maliciousInputs.length}ê°œ\n` +
                `ëª¨ë‘ ì°¨ë‹¨ë¨: ${allSafe ? 'âœ…' : 'âŒ'}\n\n` +
                `í…ŒìŠ¤íŠ¸ ê²°ê³¼:\n${results.join('\n\n')}`,
                allSafe ? 'success' : 'error'
            );
            
            addTestResult('Test 6.2: XSS ë°©ì§€', allSafe ? 'pass' : 'fail', 
                         `${maliciousInputs.length}ê°œ íŒ¨í„´ í…ŒìŠ¤íŠ¸`);
            updateTestStats(allSafe ? 1 : 0, allSafe ? 0 : 1);
        }
        
        async function runTest6DataValidation() {
            log('Test 6.3: ë°ì´í„° ê²€ì¦');
            
            const securityUtils = new SecurityUtils();
            
            // ì´ë©”ì¼ ê²€ì¦ í…ŒìŠ¤íŠ¸
            const emailTests = [
                { email: 'valid@example.com', expected: true },
                { email: 'invalid.email', expected: false },
                { email: 'test@', expected: false },
                { email: '@example.com', expected: false },
                { email: 'test@example', expected: false }
            ];
            
            let allPassed = true;
            const results = [];
            
            emailTests.forEach(test => {
                const isValid = securityUtils.isValidEmail(test.email);
                const passed = isValid === test.expected;
                
                results.push(`${test.email}: ${isValid ? 'âœ… ìœ íš¨' : 'âŒ ë¬´íš¨'} (ì˜ˆìƒ: ${test.expected ? 'ìœ íš¨' : 'ë¬´íš¨'}) ${passed ? 'âœ…' : 'âŒ'}`);
                
                if (!passed) allPassed = false;
            });
            
            showResult('test6',
                `${allPassed ? 'âœ…' : 'âŒ'} ë°ì´í„° ê²€ì¦\n\n` +
                `ì´ë©”ì¼ ê²€ì¦ í…ŒìŠ¤íŠ¸: ${emailTests.length}ê°œ\n` +
                `ëª¨ë‘ í†µê³¼: ${allPassed ? 'âœ…' : 'âŒ'}\n\n` +
                `í…ŒìŠ¤íŠ¸ ê²°ê³¼:\n${results.join('\n')}`,
                allPassed ? 'success' : 'error'
            );
            
            addTestResult('Test 6.3: ë°ì´í„° ê²€ì¦', allPassed ? 'pass' : 'fail', 
                         `${emailTests.length}ê°œ ê²€ì¦ í…ŒìŠ¤íŠ¸`);
            updateTestStats(allPassed ? 1 : 0, allPassed ? 0 : 1);
        }
    </script>
</body>
</html>
